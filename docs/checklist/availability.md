---
title: "可用性のチェックリスト"
description: "設計時の可用性に関する問題のガイダンスを提供するチェックリスト。"
author: dragon119
ms.date: 01/10/2018
ms.custom: checklist
ms.openlocfilehash: b66968f8e0e4cdde9b5ce9aea11c2b4011958b38
ms.sourcegitcommit: 3d6dba524cc7661740bdbaf43870de7728d60a01
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2018
---
# <a name="availability-checklist"></a><span data-ttu-id="7a867-103">可用性のチェックリスト</span><span class="sxs-lookup"><span data-stu-id="7a867-103">Availability checklist</span></span>

<span data-ttu-id="7a867-104">可用性とは、システムが機能し、動作している時間の割合であり、[ソフトウェア品質の重要な要素](../guide/pillars.md)の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="7a867-104">Availability is the proportion of time that a system is functional and working, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="7a867-105">このチェックリストを使用して、可用性の観点からアプリケーション アーキテクチャを見直します。</span><span class="sxs-lookup"><span data-stu-id="7a867-105">Use this checklist to review your application architecture from an availability standpoint.</span></span> 

## <a name="application-design"></a><span data-ttu-id="7a867-106">アプリケーションの設計</span><span class="sxs-lookup"><span data-stu-id="7a867-106">Application design</span></span>

<span data-ttu-id="7a867-107">**すべての単一障害点を回避します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-107">**Avoid any single point of failure.**</span></span> <span data-ttu-id="7a867-108">単一障害点が可用性に影響することを防ぐため、すべてのコンポーネント、サービス、リソース、およびコンピューティング インスタンスを複数のインスタンスとして展開する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-108">All components, services, resources, and compute instances should be deployed as multiple instances to prevent a single point of failure from affecting availability.</span></span> <span data-ttu-id="7a867-109">これには認証メカニズムが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7a867-109">This includes authentication mechanisms.</span></span> <span data-ttu-id="7a867-110">複数のインスタンスを使用するための構成ができるように、そして自動的にエラーを検出して要求をエラーのないインスタンスにリダイレクトする (これはプラットフォームでは自動的に行われません) ようにアプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="7a867-110">Design the application to be configurable to use multiple instances, and to automatically detect failures and redirect requests to non-failed instances where the platform does not do this automatically.</span></span>

<span data-ttu-id="7a867-111">**サービス レベル目標に基づいてワークロードを分解します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-111">**Decompose workloads by service-level objectove.**</span></span> <span data-ttu-id="7a867-112">サービスが重要なワークロードとあまり重要ではないワークロードで構成されている場合は、それらを異なる方法で管理し、それぞれの可用性の要件を満たすようにサービスの機能とインスタンスの数を指定します。</span><span class="sxs-lookup"><span data-stu-id="7a867-112">If a service is composed of critical and less-critical workloads, manage them differently and specify the service features and number of instances to meet their availability requirements.</span></span>

<span data-ttu-id="7a867-113">**サービスの依存関係を最少化し、把握します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-113">**Minimize and understand service dependencies.**</span></span> <span data-ttu-id="7a867-114">可能な限り、使用するサービスの数を最小化し、システムに存在するすべての機能とサービスの依存関係を把握しておきます。</span><span class="sxs-lookup"><span data-stu-id="7a867-114">Minimize the number of different services used where possible, and ensure you understand all of the feature and service dependencies that exist in the system.</span></span> <span data-ttu-id="7a867-115">これには、それぞれの依存関係の性質、および各アプリケーションのエラーまたはパフォーマンス低下が全体に与える影響が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7a867-115">This includes the nature of these dependencies, and the impact of failure or reduced performance in each one on the overall application.</span></span> <span data-ttu-id="7a867-116">「[回復性の要件を定義する](../resiliency/index.md#defining-your-resiliency-requirements)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7a867-116">See [Defining your resiliency requirements](../resiliency/index.md#defining-your-resiliency-requirements).</span></span>

<span data-ttu-id="7a867-117">**可能な限り、タスクとメッセージがべき等になるように設計します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-117">**Design tasks and messages to be idempotent where possible**.</span></span> <span data-ttu-id="7a867-118">操作を複数回繰り返し、同じ結果を生成できる場合、その操作はべき等です。</span><span class="sxs-lookup"><span data-stu-id="7a867-118">An operation is idempotent if it can be repeated multiple times and produce the same result.</span></span> <span data-ttu-id="7a867-119">べき等では、重複した要求による問題の発生を防ぐことができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-119">Idempotency can ensure that duplicated requests don't cause problems.</span></span> <span data-ttu-id="7a867-120">前に実行された操作を繰り返すことで結果が無効にならないように、メッセージ コンシューマーとコンシューマーが実行する操作がべき等である必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-120">Message consumers and the operations they carry out should be idempotent so that repeating a previously executed operation does not render the results invalid.</span></span> <span data-ttu-id="7a867-121">これは、重複したメッセージの検出、または競合処理のためのオプティミスティックな方法を使用した一貫性の確認を意味する場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-121">This may mean detecting duplicated messages, or ensuring consistency by using an optimistic approach to handling conflicts.</span></span>

<span data-ttu-id="7a867-122">**重要なトランザクションの高可用性を実装する、メッセージ ブローカーを使用します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-122">**Use a message broker that implements high availability for critical transactions.**</span></span> <span data-ttu-id="7a867-123">多くのクラウド アプリケーションでは、メッセージングを使用して非同期に実行されるタスクを開始します。</span><span class="sxs-lookup"><span data-stu-id="7a867-123">Many cloud applications use messaging to initiate tasks that are performed asynchronously.</span></span> <span data-ttu-id="7a867-124">メッセージの配信を保証するために、このメッセージング システムは高可用性を実現する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-124">To guarantee delivery of messages, the messaging system should provide high availability.</span></span> <span data-ttu-id="7a867-125">[Azure Service Bus メッセージング](/azure/service-bus-messaging)は、"*少なくとも 1 回の*" セマンティクスを実装しています。</span><span class="sxs-lookup"><span data-stu-id="7a867-125">[Azure Service Bus Messaging](/azure/service-bus-messaging) implements *at least once* semantics.</span></span> <span data-ttu-id="7a867-126">つまり、特定の状況下で重複するコピーが配信される可能性がありますが、キューに送信されたメッセージは失われません。</span><span class="sxs-lookup"><span data-stu-id="7a867-126">This means that a message posted to a queue will not be lost, although duplicate copies may be delivered under certain circumstances.</span></span> <span data-ttu-id="7a867-127">メッセージの処理がべき等である場合 (前の項目を参照)、繰り返しの配信は問題にはなりません。</span><span class="sxs-lookup"><span data-stu-id="7a867-127">If message processing is idempotent (see the previous item), repeated delivery should not be a problem.</span></span>

<span data-ttu-id="7a867-128">**グレースフル デグラデーションを実現するようにアプリケーションを設計します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-128">**Design applications to gracefully degrade.**</span></span> <span data-ttu-id="7a867-129">アプリケーションの負荷が 1 つ以上の部分の容量を超えたことによって、可用性が低下し、接続が失敗する場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-129">The load on an application may exceed the capacity of one or more parts, causing reduced availability and failed connections.</span></span> <span data-ttu-id="7a867-130">これを軽減するにはスケーリングが役立ちますが、リソースの可用性やコストなどのその他の要因によって制限に到達する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-130">Scaling can help to alleviate this, but it may reach a limit imposed by other factors, such as resource availability or cost.</span></span> <span data-ttu-id="7a867-131">アプリケーションがリソースの上限に達したときに、適切なアクションを実行してユーザーへの影響を最小限に抑える必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-131">When an application reaches a resource limit, it should take appropriate action to minimize the impact for the user.</span></span> <span data-ttu-id="7a867-132">たとえば、電子商取引システムで注文処理サブシステムに負荷がかかっている場合やエラーが発生した場合は、サブシステムを一時的に無効にし、他の機能 (製品カタログの参照など) を続行することができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-132">For example, in an ecommerce system, if the order-processing subsystem is under strain or fails, it can be temporarily disabled while allowing other functionality, such as browsing the product catalog.</span></span> <span data-ttu-id="7a867-133">エラーが発生しているサブシステムへの要求を遅らせることが適切な場合があります。たとえば、顧客が注文を送信し、その注文を注文サブシステムが再度使用可能になったら後で処理できるように保存することができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-133">It might be appropriate to postpone requests to a failing subsystem, for example still enabling customers to submit orders but saving them for later processing, when the orders subsystem is available again.</span></span>

<span data-ttu-id="7a867-134">**急速なバースト イベントを適切に処理します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-134">**Gracefully handle rapid burst events.**</span></span> <span data-ttu-id="7a867-135">ほとんどのアプリケーションでは、経時的に変化するワークロードを処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-135">Most applications need to handle varying workloads over time.</span></span> <span data-ttu-id="7a867-136">自動スケールは負荷の処理に役立ちますが、追加のインスタンスがオンラインになり、要求を処理するまでに時間がかかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-136">Auto-scaling can help to handle the load, but it may take some time for additional instances to come online and handle requests.</span></span> <span data-ttu-id="7a867-137">アクティビティで突然、予期しないバーストが発生してもアプリケーションで過負荷が発生しないようにします。これには、キューが容量に近づいたら使用するサービスに要求のキューを入れ、適切に機能が低下するように設計します。</span><span class="sxs-lookup"><span data-stu-id="7a867-137">Prevent sudden and unexpected bursts of activity from overwhelming the application: design it to queue requests to the services it uses and degrade gracefully when queues are near to full capacity.</span></span> <span data-ttu-id="7a867-138">バーストしない条件下で、キューを排出して未処理の要求を処理するために十分なパフォーマンスと容量を確保できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="7a867-138">Ensure that there is sufficient performance and capacity available under non-burst conditions to drain the queues and handle outstanding requests.</span></span> <span data-ttu-id="7a867-139">詳細については、「[Queue-Based Load Leveling Pattern (キュー ベースの負荷平準化パターン)](https://msdn.microsoft.com/library/dn589783.aspx)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-139">For more information, see the [Queue-Based Load Leveling Pattern](https://msdn.microsoft.com/library/dn589783.aspx).</span></span>

## <a name="deployment-and-maintenance"></a><span data-ttu-id="7a867-140">展開と保守</span><span class="sxs-lookup"><span data-stu-id="7a867-140">Deployment and maintenance</span></span>

<span data-ttu-id="7a867-141">**複数のインスタンスのサービスをデプロイします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-141">**Deploy multiple instances of services.**</span></span> <span data-ttu-id="7a867-142">アプリケーションがサービスの 1 つのインスタンスに依存する場合は、単一障害点が発生します。</span><span class="sxs-lookup"><span data-stu-id="7a867-142">If your application depends on a single instance of a service, it creates a single point of failure.</span></span> <span data-ttu-id="7a867-143">複数のインスタンスをプロビジョニングすると、回復性とスケーラビリティの両方が改善されます。</span><span class="sxs-lookup"><span data-stu-id="7a867-143">Provisioning multiple instances improves both resiliency and scalability.</span></span> <span data-ttu-id="7a867-144">[Azure App Service](/azure/app-service/app-service-value-prop-what-is/) の場合は、複数のインスタンスを提供する [App Service プラン](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)を選択してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-144">For [Azure App Service](/azure/app-service/app-service-value-prop-what-is/), select an [App Service Plan](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/) that offers multiple instances.</span></span> <span data-ttu-id="7a867-145">Azure Cloud Services の場合は、[複数インスタンス](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management)を使用するように各ロールを構成してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-145">For Azure Cloud Services, configure each of your roles to use [multiple instances](/azure/cloud-services/cloud-services-choose-me/#scaling-and-management).</span></span> <span data-ttu-id="7a867-146">[Azure Virtual Machines (VM)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) の場合は、VM アーキテクチャに 1 つ以上の VM が含まれていることと、[可用性セット][availability-sets]に各 VM が含まれていることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-146">For [Azure Virtual Machines (VMs)](/azure/virtual-machines/virtual-machines-windows-about/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json), ensure that your VM architecture includes more than one VM and that each VM is included in an [availability set][availability-sets].</span></span>

<span data-ttu-id="7a867-147">**アプリケーションを複数のリージョンにデプロイすることを検討します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-147">**Consider deploying your application across multiple regions.**</span></span> <span data-ttu-id="7a867-148">アプリケーションが 1 つのリージョンにデプロイされている場合は、まれにリージョン全体が使用できなくなった場合に、アプリケーションも使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="7a867-148">If your application is deployed to a single region, in the rare event the entire region becomes unavailable, your application will also be unavailable.</span></span> <span data-ttu-id="7a867-149">これは、アプリケーションの SLA の条件の下では許容できないことがあります。</span><span class="sxs-lookup"><span data-stu-id="7a867-149">This may be unacceptable under the terms of your application's SLA.</span></span> <span data-ttu-id="7a867-150">その場合は、アプリケーションとそのサービスを複数のリージョンにデプロイすることを検討してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-150">If so, consider deploying your application and its services across multiple regions.</span></span>

<span data-ttu-id="7a867-151">**デプロイおよび保守のタスクを自動化してテストします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-151">**Automate and test deployment and maintenance tasks.**</span></span> <span data-ttu-id="7a867-152">分散アプリケーションは、連携して動作する必要がある、複数の部分で構成されます。</span><span class="sxs-lookup"><span data-stu-id="7a867-152">Distributed applications consist of multiple parts that must work together.</span></span> <span data-ttu-id="7a867-153">スクリプトなどのテスト済みおよび実証済みのメカニズムを使用して、デプロイを自動化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-153">Deployment should be automated, using tested and proven mechanisms such as scripts.</span></span> <span data-ttu-id="7a867-154">これらのメカニズムでは、構成を更新および検証し、デプロイ プロセスを自動化することができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-154">These can update and validate configuration, and automate the deployment process.</span></span> <span data-ttu-id="7a867-155">[Azure Resource Manager テンプレート](/azure/azure-resource-manager/resource-group-authoring-templates)を使用して Azure リソースをプロビジョニングします。</span><span class="sxs-lookup"><span data-stu-id="7a867-155">Use [Azure Resource Manager templates](/azure/azure-resource-manager/resource-group-authoring-templates) to provision Azure resource.</span></span> <span data-ttu-id="7a867-156">また、アプリケーションの更新を実行する自動化された手法も使用します。</span><span class="sxs-lookup"><span data-stu-id="7a867-156">Also use automated techniques to perform application updates.</span></span> <span data-ttu-id="7a867-157">エラーによってさらにダウンタイムが発生しないように、このすべてのプロセスを完全にテストすることが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="7a867-157">It is vital to test all of these processes fully to ensure that errors do not cause additional downtime.</span></span> <span data-ttu-id="7a867-158">すべての展開ツールには展開されたアプリケーションを保護するための、適切なセキュリティ制限が必要です。展開ポリシーは慎重に定義して適用し、人間の介入は最小限に抑えてください。</span><span class="sxs-lookup"><span data-stu-id="7a867-158">All deployment tools must have suitable security restrictions to protect the deployed application; define and enforce deployment policies carefully and minimize the need for human intervention.</span></span>

<span data-ttu-id="7a867-159">**プラットフォームのステージングおよび運用機能を使用します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-159">**Use staging and production features of the platform.**.</span></span> <span data-ttu-id="7a867-160">たとえば、Azure App Service では、デプロイを運用環境に切り替える前のステージングに使用できる[展開スロット](/azure/app-service/web-sites-staged-publishing)をサポートします。</span><span class="sxs-lookup"><span data-stu-id="7a867-160">For example, Azure App Service supports [deployment slots](/azure/app-service/web-sites-staged-publishing), which you can use to stage a deployment before swapping it to production.</span></span> <span data-ttu-id="7a867-161">Azure Service Fabric では、アプリケーション サービスの[ローリング アップグレード](/azure/service-fabric/service-fabric-application-upgrade)をサポートします。</span><span class="sxs-lookup"><span data-stu-id="7a867-161">Azure Service Fabric supports [rolling upgrades](/azure/service-fabric/service-fabric-application-upgrade) to application services.</span></span>

<span data-ttu-id="7a867-162">**仮想マシン (VM) を可用性セットに配置します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-162">**Place virtual machines (VMs) in an availability set.**</span></span> <span data-ttu-id="7a867-163">可用性を最大限にするには、各 VM ロールの複数のインスタンスを作成し、それらのインスタンスを同じ可用性セットに配置します。</span><span class="sxs-lookup"><span data-stu-id="7a867-163">To maximize availability, create multiple instances of each VM role and place these instances in the same availability set.</span></span> <span data-ttu-id="7a867-164">異なるアプリケーション層など、さまざまなロールが適用された複数の VM がある場合は、VM ロールごとに可用性セットを作成します。</span><span class="sxs-lookup"><span data-stu-id="7a867-164">If have multiple VMs that serve different roles, such as different application tiers, create an availability set for each VM role.</span></span> <span data-ttu-id="7a867-165">たとえば、Web 層の可用性セットを作成し、データ層には別の可用性セットを作成します。</span><span class="sxs-lookup"><span data-stu-id="7a867-165">For example, create an availability set for the web tier and another for the data tier.</span></span>

## <a name="data-management"></a><span data-ttu-id="7a867-166">[データ管理]</span><span class="sxs-lookup"><span data-stu-id="7a867-166">Data management</span></span>

<span data-ttu-id="7a867-167">**Azure Storage のデータの geo レプリケーション**。</span><span class="sxs-lookup"><span data-stu-id="7a867-167">**Geo-replicate data in Azure Storage**.</span></span> <span data-ttu-id="7a867-168">Azure Storage 内のデータは、データセンター内で自動的にレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="7a867-168">Data in Azure Storage is automatically replicated within in a datacenter.</span></span> <span data-ttu-id="7a867-169">さらに高い可用性を実現するには、読み取りアクセス geo 冗長ストレージを使用して (RAGRS)、セカンダリ リージョンにデータをレプリケートし、セカンダリ ロケーションのデータに読み取り専用のアクセスを付与します。</span><span class="sxs-lookup"><span data-stu-id="7a867-169">For even higher availability, use Read-access geo-redundant storage (-RAGRS), which replicates your data to a secondary region and provides read-only access to the data in the secondary location.</span></span> <span data-ttu-id="7a867-170">地域全体が停電になった場合や災害が発生した場合でも、データは保持されます。</span><span class="sxs-lookup"><span data-stu-id="7a867-170">The data is durable even in the case of a complete regional outage or a disaster.</span></span> <span data-ttu-id="7a867-171">詳細については、「[Azure Storage のレプリケーション](/azure/storage/storage-redundancy)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7a867-171">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy).</span></span>

<span data-ttu-id="7a867-172">**データベースの geo レプリケーション**。</span><span class="sxs-lookup"><span data-stu-id="7a867-172">**Geo-replicate databases**.</span></span> <span data-ttu-id="7a867-173">Azure SQL Database と Cosmos DB は、どちらも geo レプリケーションをサポートしており、他のリージョンでセカンダリ データベースのレプリカを構成できるようになっています。</span><span class="sxs-lookup"><span data-stu-id="7a867-173">Azure SQL Database and Cosmos DB both support geo-replication, which enables you to configure secondary database replicas in other regions.</span></span> <span data-ttu-id="7a867-174">セカンダリ データベースは、データ センターで障害が発生した場合やプライマリ データベースに接続できない場合のクエリとフェールオーバーに使用できます。</span><span class="sxs-lookup"><span data-stu-id="7a867-174">Secondary databases are available for querying and for failover in the case of a data center outage or the inability to connect to the primary database.</span></span> <span data-ttu-id="7a867-175">詳細については、[フェールオーバー グループとアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) に関する記事、および「[Azure Cosmos DB を使用してデータをグローバルに分散させる方法](/azure/cosmos-db/distribute-data-globally)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7a867-175">For more information, see [Failover groups and active geo-replication](/azure/sql-database/sql-database-geo-replication-overview) (SQL Database) and [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

<span data-ttu-id="7a867-176">**オプティミスティック同時実行制御と最終的な整合性を使用します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-176">**Use optimistic concurrency and eventual consistency**.</span></span> <span data-ttu-id="7a867-177">ロックによってリソースへのアクセスをブロックするトランザクション (ペシミスティック同時実行制御) では、パフォーマンスが低下し、可用性も大幅に低下する場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-177">Transactions that block access to resources through locking (pessimistic concurrency) can cause poor performance and considerably reduce availability.</span></span> <span data-ttu-id="7a867-178">これらの問題は、分散システムで特に深刻になります。</span><span class="sxs-lookup"><span data-stu-id="7a867-178">These problems can become especially acute in distributed systems.</span></span> <span data-ttu-id="7a867-179">多くの場合、パーティション分割などの入念な設計や技法によって、更新プログラムの競合が発生する可能性を最小限に抑えることができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-179">In many cases, careful design and techniques such as partitioning can minimize the chances of conflicting updates occurring.</span></span> <span data-ttu-id="7a867-180">データがレプリケートされたり、個別に更新されたスコアから読み取られたりすると、最終段階でのみ、データの一貫性が確保されます。</span><span class="sxs-lookup"><span data-stu-id="7a867-180">Where data is replicated, or is read from a separately updated store, the data will only be eventually consistent.</span></span> <span data-ttu-id="7a867-181">ただし、通常、その利点は、即座に一貫性を確保するトランザクションを使用できることに対する効果を大きく上回ります。</span><span class="sxs-lookup"><span data-stu-id="7a867-181">But the advantages usually far outweigh the impact on availability of using transactions to ensure immediate consistency.</span></span>

<span data-ttu-id="7a867-182">**定期的なバックアップとポイントインタイム リストアを使用します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-182">**Use periodic backup and point-in-time restore**.</span></span> <span data-ttu-id="7a867-183">他の場所には保存されないデータを定期的に自動でバックアップして、障害発生時でもデータとアプリケーション自体の両方を安全に復元できることを確認します。</span><span class="sxs-lookup"><span data-stu-id="7a867-183">Regularly and automatically back up data that is not preserved elsewhere, and verify you can reliably restore both the data and the application itself should a failure occur.</span></span> <span data-ttu-id="7a867-184">バックアップが目標復旧時点 (RPO) を満たしていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="7a867-184">Ensure that backups meet your Recovery Point Objective (RPO).</span></span> <span data-ttu-id="7a867-185">データ レプリケーションはバックアップ機能ではありません。人為的なミスや悪意のある操作によって、すべてのレプリカでデータが破損する可能性があるためです。</span><span class="sxs-lookup"><span data-stu-id="7a867-185">Data replication is not a backup feature, because human error or malicious operations can corrupt data across all the replicas.</span></span> <span data-ttu-id="7a867-186">バックアップ プロセスは、転送中のデータと格納中のデータを保護するため、セキュリティで保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-186">The backup process must be secure to protect the data in transit and in storage.</span></span> <span data-ttu-id="7a867-187">データベースまたはデータ ストアの一部は通常、トランザクション ログを使用して前の時点まで回復することができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-187">Databases or parts of a data store can usually be recovered to a previous point in time by using transaction logs.</span></span> <span data-ttu-id="7a867-188">詳細については、「[Recover from data corruption or accidental deletion (データの破損または偶発的な削除からの復旧)](../resiliency/recovery-data-corruption.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7a867-188">For more information, see [Recover from data corruption or accidental deletion](../resiliency/recovery-data-corruption.md)</span></span>

## <a name="errors-and-failures"></a><span data-ttu-id="7a867-189">エラーと障害</span><span class="sxs-lookup"><span data-stu-id="7a867-189">Errors and failures</span></span>

<span data-ttu-id="7a867-190">**要求タイムアウトを構成します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-190">**Configure request timeouts.**</span></span> <span data-ttu-id="7a867-191">サービスとリソースが使用不可能になり、要求が失敗する原因となる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-191">Services and resources may become unavailable, causing requests to fail.</span></span> <span data-ttu-id="7a867-192">適用するタイムアウトが各サービスまたはリソースに加え、それらにアクセスしているクライアントに適切であるかどうかを確認します </span><span class="sxs-lookup"><span data-stu-id="7a867-192">Ensure that the timeouts you apply are appropriate for each service or resource as well as the client that is accessing them.</span></span> <span data-ttu-id="7a867-193">コンテキストやクライアントが実行しているアクションによっては、クライアントの特定のインスタンスのタイムアウトを長くすることができる場合もあります。</span><span class="sxs-lookup"><span data-stu-id="7a867-193">In some cases, you might allow a longer timeout for a particular instance of a client, depending on the context and other actions that the client is performing.</span></span> <span data-ttu-id="7a867-194">タイムアウトが短すぎると、待機時間が非常に長いサービスとリソースで過剰な再試行操作が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-194">Very short timeouts may cause excessive retry operations for services and resources that have considerable latency.</span></span> <span data-ttu-id="7a867-195">また、タイムアウトが長すぎると、大量の要求がキューにあり、サービスまたはリソースの応答を待機している場合にブロックが発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-195">Very long timeouts can cause blocking if a large number of requests are queued, waiting for a service or resource to respond.</span></span>

<span data-ttu-id="7a867-196">**一時的な障害により失敗した操作を再試行します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-196">**Retry failed operations caused by transient faults.**</span></span> <span data-ttu-id="7a867-197">本来は自動的な接続再試行をサポートしていないすべてのサービスおよびリソースにアクセスするための再試行戦略を設計します。</span><span class="sxs-lookup"><span data-stu-id="7a867-197">Design a retry strategy for access to all services and resources where they do not inherently support automatic connection retry.</span></span> <span data-ttu-id="7a867-198">リソースのオーバーロードを防ぎ、キューに登録されている要求を適切に復元して処理できるように、障害の数が増えるにつれて再試行の間の遅延が増加するような戦略を使用します。</span><span class="sxs-lookup"><span data-stu-id="7a867-198">Use a strategy that includes an increasing delay between retries as the number of failures increases, to prevent overloading of the resource and to allow it to gracefully recover and handle queued requests.</span></span> <span data-ttu-id="7a867-199">非常に短い遅延の再試行が連続すると、問題が悪化する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-199">Continual retries with very short delays are likely to exacerbate the problem.</span></span> <span data-ttu-id="7a867-200">詳細については、「[特定のサービスの再試行ガイダンス](../best-practices/retry-service-specific.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-200">For more information, see [Retry guidance for specific services](../best-practices/retry-service-specific.md).</span></span>

<span data-ttu-id="7a867-201">**サーキット ブレークを実装して連鎖的な障害を回避します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-201">**Implement circuit breaking to avoid cascading failures.**</span></span> <span data-ttu-id="7a867-202">一時的またはその他の障害で、接続の部分的な損失からサービス全体の障害まで重要度が多岐にわたる場合、通常の状態に戻るまでに予想よりも時間がかかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-202">There may be situations in which transient or other faults, ranging in severity from a partial loss of connectivity to the complete failure of a service, take much longer than expected to return to normal.</span></span> <span data-ttu-id="7a867-203">サービスが非常にビジーな状態で、メモリ、スレッド、データベース接続などの重要なシステム リソースが使用されていると、システムの 1 つの部分の障害が連鎖的な障害に発展し、多くの操作がブロックされる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-203">, if a service is very busy, failure in one part of the system may lead to cascading failures, and result in many operations becoming blocked while holding onto critical system resources such as memory, threads, and database connections.</span></span> <span data-ttu-id="7a867-204">アプリケーションは、成功の見込みのない操作を継続的に再試行するのではなく、操作が失敗していることを迅速に受け入れ、このエラーを適切に処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-204">Instead of continually retrying an operation that is unlikely to succeed, the application should quickly accept that the operation has failed, and gracefully handle this failure.</span></span> <span data-ttu-id="7a867-205">サーキット ブレーカー パターンを使用して、一定期間、特定の操作の要求を拒否します。</span><span class="sxs-lookup"><span data-stu-id="7a867-205">Use the Circuit Breaker pattern to reject requests for specific operations for defined periods.</span></span> <span data-ttu-id="7a867-206">詳細については、「[Circuit Breaker Pattern (Circuit Breaker パターン)](../patterns/circuit-breaker.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="7a867-206">For more information, see [Circuit Breaker Pattern](../patterns/circuit-breaker.md).</span></span>

<span data-ttu-id="7a867-207">**複数のコンポーネントを構成するか、複数のコンポーネントにフォールバックします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-207">**Compose or fall back to multiple components.**</span></span> <span data-ttu-id="7a867-208">操作や既存の接続になるべく影響を与えずに複数のインスタンスを使用するようにアプリケーションを設計します。</span><span class="sxs-lookup"><span data-stu-id="7a867-208">Design applications to use multiple instances without affecting operation and existing connections where possible.</span></span> <span data-ttu-id="7a867-209">可用性を最大化するため、複数のインスタンスを使用してそれらの間に要求を分散し、失敗したインスタンスへの要求の送信を検出して回避します。</span><span class="sxs-lookup"><span data-stu-id="7a867-209">Use multiple instances and distribute requests between them, and detect and avoid sending requests to failed instances, in order to maximize availability.</span></span>

<span data-ttu-id="7a867-210">**別のサービスまたはワークフローにフォールバックします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-210">**Fall back to a different service or workflow.**</span></span> <span data-ttu-id="7a867-211">たとえば、SQL Database への書き込みに失敗した場合は、一時的にデータを Blob Storage または Redis Cache に保存します。</span><span class="sxs-lookup"><span data-stu-id="7a867-211">For example, if writing to SQL Database fails, temporarily store data in blob storage or Redis Cache.</span></span> <span data-ttu-id="7a867-212">サービスが利用可能になったときに SQL Database への書き込みを再生する方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="7a867-212">Provide a way to replay the writes to SQL Database when the service becomes available.</span></span> <span data-ttu-id="7a867-213">失敗した操作には、コンポーネントまたはサービスが失敗してもアプリケーションが動作し続けられるような代替の操作がある場合もあります。</span><span class="sxs-lookup"><span data-stu-id="7a867-213">In some cases, a failed operation may have an alternative action that allows the application to continue to work even when a component or service fails.</span></span> <span data-ttu-id="7a867-214">可能であれば、エラーを検出し、適切な代替機能を提供できる他のサービスか、プライマリ サービスがオフラインの間もコアな操作を維持できるバックアップ機能または制限された機能のインスタンスに要求をリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="7a867-214">If possible, detect failures and redirect requests to other services that can offer a suitable alternative functionality, or to back up or reduced functionality instances that can maintain core operations while the primary service is offline.</span></span>

## <a name="monitoring-and-disaster-recovery"></a><span data-ttu-id="7a867-215">監視と障害復旧</span><span class="sxs-lookup"><span data-stu-id="7a867-215">Monitoring and disaster recovery</span></span>

<span data-ttu-id="7a867-216">**可能性の高い障害や障害イベントの豊富なインストルメンテーションを提供します** 。</span><span class="sxs-lookup"><span data-stu-id="7a867-216">**Provide rich instrumentation for likely failures and failure events** to report the situation to operations staff.</span></span> <span data-ttu-id="7a867-217">可能性が高いがまだ発生していない障害については、運用スタッフが原因を判別し、状況を緩和し、システムが引き続き使用できるようにするための十分なデータを提供します。</span><span class="sxs-lookup"><span data-stu-id="7a867-217">For failures that are likely but have not yet occurred, provide sufficient data to enable operations staff to determine the cause, mitigate the situation, and ensure that the system remains available.</span></span> <span data-ttu-id="7a867-218">既に発生している障害については、アプリケーションがユーザーに適切なエラー メッセージを返しながらも、機能が制限された状態で実行を続行しようとする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-218">For failures that have already occurred, the application should return an appropriate error message to the user but attempt to continue running, albeit with reduced functionality.</span></span> <span data-ttu-id="7a867-219">どの場合も、監視システムは運用スタッフが迅速な回復が行えるように包括的な詳細をキャプチャし、必要に応じてデザイナーと開発者が状況の再発を防ぐため、システムを修正する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-219">In all cases, the monitoring system should capture comprehensive details to enable operations staff to effect a quick recovery, and if necessary, for designers and developers to modify the system to prevent the situation from arising again.</span></span>

<span data-ttu-id="7a867-220">**チェック機能を実装することでシステム正常性を監視します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-220">**Monitor system health by implementing checking functions.**</span></span> <span data-ttu-id="7a867-221">アプリケーションの正常性とパフォーマンスは、時間の経過と共に低下し、障害が発生するまで気づかない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-221">The health and performance of an application can degrade over time, without being noticeable until it fails.</span></span> <span data-ttu-id="7a867-222">アプリケーションの外部から定期的に実行されるプローブやチェック機能を実装してください。</span><span class="sxs-lookup"><span data-stu-id="7a867-222">Implement probes or check functions that are executed regularly from outside the application.</span></span> <span data-ttu-id="7a867-223">これらのチェックは、アプリケーション全体、アプリケーションの個々 の部分、アプリケーションが使用する個々 のサービス、または個々 のコンポーネントの応答時間を測定するのと同じくらい単純にすることができます。</span><span class="sxs-lookup"><span data-stu-id="7a867-223">These checks can be as simple as measuring response time for the application as a whole, for individual parts of the application, for individual services that the application uses, or for individual components.</span></span> <span data-ttu-id="7a867-224">チェック機能はプロセスを実行することで、有効な結果が生成され、待機時間とチェック機能が測定され、システムから情報が抽出されていることを確認できます。</span><span class="sxs-lookup"><span data-stu-id="7a867-224">Check functions can execute processes to ensure they produce valid results, measure latency and check availability, and extract information from the system.</span></span>

<span data-ttu-id="7a867-225">**すべてのフェールオーバーおよびフォールバック システムを定期的にテストします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-225">**Regularly test all failover and fallback systems.**</span></span> <span data-ttu-id="7a867-226">システムおよび操作の変更はフェールオーバーおよびフォールバック機能に影響を与える可能性がありますが、その影響はメインのシステムで障害が発生するか、オーバーロードが発生するまで検出されない場合があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-226">Changes to systems and operations may affect failover and fallback functions, but the impact may not be detected until the main system fails or becomes overloaded.</span></span> <span data-ttu-id="7a867-227">実行時に、発生中の問題を補正しなければならなくなる前にテストしてください。</span><span class="sxs-lookup"><span data-stu-id="7a867-227">Test it before it is required to compensate for a live problem at runtime.</span></span>

<span data-ttu-id="7a867-228">**監視システムをテストします。**</span><span class="sxs-lookup"><span data-stu-id="7a867-228">**Test the monitoring systems.**</span></span> <span data-ttu-id="7a867-229">自動フェールオーバーとフォールバック システム、およびダッシュボードを使用したシステム正常性とパフォーマンスの手動の視覚化はすべて、正常に機能している監視およびインストルメンテーションに依存しています。</span><span class="sxs-lookup"><span data-stu-id="7a867-229">Automated failover and fallback systems, and manual visualization of system health and performance by using dashboards, all depend on monitoring and instrumentation functioning correctly.</span></span> <span data-ttu-id="7a867-230">これらの要素で障害、重要な情報の不足、不適切なデータの報告が発生すると、オペレーターはシステムが正常でないことやシステムで障害が発生していることに気付かない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="7a867-230">If these elements fail, miss critical information, or report inaccurate data, an operator might not realize that the system is unhealthy or failing.</span></span>

<span data-ttu-id="7a867-231">**実行時間の長いワークフローの進行状況を追跡し、障害発生時に再試行します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-231">**Track the progress of long-running workflows and retry on failure.**</span></span> <span data-ttu-id="7a867-232">実行時間の長いワークフローは多くの場合、複数の手順で構成されています。</span><span class="sxs-lookup"><span data-stu-id="7a867-232">Long-running workflows are often composed of multiple steps.</span></span> <span data-ttu-id="7a867-233">各手順が独立していること、および各手順の再試行によってワークフロー全体のロールバックや、複数の補正トランザクションを実行しなければならない事態が最小限に抑えられることを確認します。</span><span class="sxs-lookup"><span data-stu-id="7a867-233">Ensure that each step is independent and can be retried to minimize the chance that the entire workflow will need to be rolled back, or that multiple compensating transactions need to be executed.</span></span> <span data-ttu-id="7a867-234">[Scheduler Agent Supervisor パターン](../patterns/scheduler-agent-supervisor.md)などのパターンを実装して、実行時間の長いワークフローの進行状況を監視し、管理します。</span><span class="sxs-lookup"><span data-stu-id="7a867-234">Monitor and manage the progress of long-running workflows by implementing a pattern such as [Scheduler Agent Supervisor Pattern](../patterns/scheduler-agent-supervisor.md).</span></span>

<span data-ttu-id="7a867-235">**障害復旧を計画します。**</span><span class="sxs-lookup"><span data-stu-id="7a867-235">**Plan for disaster recovery.**</span></span> <span data-ttu-id="7a867-236">十分なテストを実施した許容可能な計画を作成し、システムの可用性に影響を及ぼす可能性のある、あらゆる種類の障害から復旧できるようにします。</span><span class="sxs-lookup"><span data-stu-id="7a867-236">Create an accepted, fully-tested plan for recovery from any type of failure that may affect system availability.</span></span> <span data-ttu-id="7a867-237">ミッションクリティカルなあらゆるアプリケーションに対応できる、マルチサイトのディザスター リカバリー アーキテクチャを選択します。</span><span class="sxs-lookup"><span data-stu-id="7a867-237">Choose a multi-site disaster recovery architecture for any mission-critical applications.</span></span> <span data-ttu-id="7a867-238">自動化やテストも含めたディザスター リカバリー プランの特定のオーナーを指定します。</span><span class="sxs-lookup"><span data-stu-id="7a867-238">Identify a specific owner of the disaster recovery plan, including automation and testing.</span></span> <span data-ttu-id="7a867-239">計画の内容が詳細に文書化されていることを確認し、可能な限り、プロセスを自動化します。</span><span class="sxs-lookup"><span data-stu-id="7a867-239">Ensure the plan is well-documented, and automate the process as much as possible.</span></span> <span data-ttu-id="7a867-240">すべての参照データとトランザクション データに対してバックアップ戦略を確立し、これらのバックアップの復元を定期的にテストします。</span><span class="sxs-lookup"><span data-stu-id="7a867-240">Establish a backup strategy for all reference and transactional data, and test the restoration of these backups regularly.</span></span> <span data-ttu-id="7a867-241">運用スタッフに対して計画実行のトレーニングを行うと共に、災害のシミュレーションを定期的に実施して計画を検証、および改善します。</span><span class="sxs-lookup"><span data-stu-id="7a867-241">Train operations staff to execute the plan, and perform regular disaster simulations to validate and improve the plan.</span></span>

<!-- links -->
[availability-sets]:/azure/virtual-machines/virtual-machines-windows-manage-availability/
