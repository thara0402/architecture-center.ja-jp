# <a name="devops-checklist"></a>DevOps チェックリスト

DevOps とは、開発と品質保証と IT 運用を、統一されたカルチャと一連のプロセスに融合することによってソフトウェアを開発する手法です。 

このチェックリストは、DevOps のカルチャとプロセスを評価するための出発点としてご利用ください。

## <a name="culture"></a>カルチャ

**組織とチームとの間で業務上の整合性を確保する。** リソース、目的、目標、優先度に対する認識が同じ組織内で異なっていると、運用上のリスクを招く場合があります。 業務、開発、運用のすべてのチームが認識を共有する必要があります。

**チーム全体でソフトウェア ライフサイクルを確実に理解する。** アプリケーションの全体的なライフサイクルがどのようなもので、現在アプリケーションがどの段階にあるかをチームで理解する必要があります。 そのことは、今すべきこと、そして将来に向けて計画し、準備すべきことをチームのメンバー全員が把握することにつながります。

**サイクル時間を減らす。** 極力時間を短縮する目的は、アイデアを使用に適したソフトウェアの開発へと進展させるためです。 個々のリリースの規模と範囲を制限することで、テストの負荷を低く抑えてください。 ビルド、テスト、構成、デプロイの各プロセスは、可能な限り自動化します。 開発者間や、開発者と運用担当者との間の意思疎通の妨げとなる要素があれば解消してください。 

**プロセスを見直して改善する。** 自動化されたものであれ、手動によるものであれ、プロセスと手順に決して完成はありません。 絶えず改善することを目的に、現行のワークフロー、手順、ドキュメントに対する定期的な見直しの機会を設けてください。

**先を見越して計画する。** あらかじめ失敗を織り込んで計画します。 問題が発生したときにそれを迅速に特定し、対応にあたる正しいチーム メンバーにエスカレートして、解決策を確認するためのプロセスを設けておきましょう。

**失敗から学ぶ。** 失敗は必ず起こるものですが、それを繰り返さないために失敗から学ぶことが大切です。 運用上の障害が発生した場合、問題をトリアージし、原因と解決策を文書化して、得られた教訓があれば共有します。 できれば、今後同じ種類の障害が発生したときに自動的に検出できるように既存のビルド プロセスを更新しましょう。

**スピードを最適化し、データを収集する。** 計画した改善策はどれも仮説です。 できるだけ小さな間隔で実施するようにしましょう。 新しいアイデアは実験として扱います。 運用データを収集してその効果を評価できるよう実験をインストルメント化してください。 仮説が間違っていたら、速やかに失敗を認める覚悟が必要です。

**学ぶ時間を見込む。** 失敗と成功は、どちらも良い学びの機会です。 新しいプロジェクトに進む前に、重要な教訓を蓄積するための時間を十分に見込み、それらの教訓が確実にチームに浸透するようにしましょう。 チームがスキルを形成する時間や、実験する時間、新しいツールや手法を身に付ける時間も確保してください。 

**操作を文書化する。** 製品コードと同じ品質水準で、すべてのツール、プロセス、自動化タスクを文書化します。 実際にサポートするシステムの現在の設計とアーキテクチャを、復旧プロセスなどの各種のメンテナンス手順と併せて文書化します。 理論上最適なプロセスではなく、実際に自分が実行する手順に重点を置いてください。 その文書を定期的に見直して更新します。 コードに関して、特にパブリック API では、有意義なコメントが含まれていることを確認してください。コード ドキュメントは、できるだけツールを使用して自動的に生成しましょう。 

**知識を共有する。** 文書は、人々がその存在を把握し、見つけることができたときに初めて人の役に立ちます。 文書が整理されていて、見つけやすいことが大切です。 ランチでの歓談 (非公式のプレゼンテーション)、ビデオ、ニュースレターなど、工夫して機会を設け知識を共有します。

## <a name="development"></a>開発

**運用環境と同様の環境を開発者に提供する。** 開発環境とテスト環境が運用環境と一致しないと、問題をテストして診断することが難しくなります。 そのため開発環境とテスト環境は、できるだけ運用環境に近い状態に保つようにしてください。 テスト データは、運用環境で使用されているデータと矛盾がないようにしてください。(プライバシーやコンプライアンス上の理由から) 実際の運用データではなくサンプル データであっても同様です。 サンプル テスト データを生成して、匿名化することを検討してください。

**権限のあるすべてのチーム メンバーがインフラストラクチャのプロビジョニングとアプリケーションのデプロイに対応できるよう徹底する。** 運用環境と同様のリソースをセットアップしたりアプリケーションをデプロイしたりするために、システムに関する詳しい技術知識や手動での複雑なタスクが要求されるのは好ましくありません。 適切な権限さえあればだれでも、運用チームの協力を仰ぐことなく、運用環境と同様のリソースを作成またはデプロイできることが必要です。 

> この推奨事項は、運用環境にライブ更新をだれでもプッシュできるという意味ではありません。 大切なのは、開発チームと QA チームの摩擦を減らして運用環境と同様の環境を作成することです。

**アプリケーションをインストルメント化して洞察を得る。** アプリケーションの正常性を把握するためには、それがどのように実行されているか、またエラーや問題が発生しているかどうかを知る必要があります。 設計要件として必ずインストルメンテーションを含め、アプリケーションに最初からインストルメンテーションを組み込むようにします。 インストルメンテーションには、根本原因分析に使用するイベント ログのほか、アプリケーションの全体的な正常性と使用状況を監視するためのテレメトリとメトリックを含める必要があります。

**技術的完成度の低い部分を追跡する。** 多くのプロジェクトでは、程度の差こそあれ、リリース スケジュールがコード品質よりも優先されることがあります。 そのようなことが起こったら必ず追跡してください。 ショートカットや最適でない実装があれば文書化し、将来、それらの問題を再検討するための時間をスケジュールしましょう。

**運用環境に直接更新をプッシュすることを検討する。** 全体的なリリース サイクル時間を抑えるため、適切にテストされたコードのコミットを直接運用環境にプッシュすることを検討してください。 どの機能を有効にするかは、[フィーチャー トグル][feature-toggles]を使用して制御します。 トグルを使用して機能を有効または無効にすることで、開発からリリースへと直ちに切り替えることができます。 [カナリア リリース][canary-release] (特定の機能を一部の運用環境に限定してデプロイすること) など、各種のテストを実施する際もトグルは効果的です。

## <a name="testing"></a>テスト

**テストを自動化する。** ソフトウェアを手動でテストするのは、面倒なうえに間違いが生じる可能性が高くなります。 頻繁に行うテスト タスクは自動化し、そのテストをビルド プロセスに統合しましょう。 テストを自動化することで、テストの範囲と再現性に一貫性が保たれます。 統合された UI テストも自動ツールで実行することをお勧めします。 Azure では、テストの構成と実行を支援する開発リソースとテスト リソースを用意しています。 詳細については、「[開発とテスト][dev-test]」を参照してください。

**障害に備えたテストを実施する。** サービスに接続できなくなった場合のシステムの反応を考えてみましょう。 サービスが再び利用可能な状態になった後で回復できるでしょうか。 テスト環境とステージング環境における標準的なレビューの一環として、フォールト挿入テストを実施してください。 テストのプロセスと手法が成熟してきたら、それらのテストを運用環境で実行することを検討します。 

**運用環境でテストする。** リリース プロセスは運用環境にデプロイしたらそれで終わりというわけではありません。 デプロイしたコードが、想定したとおりに機能することを確かめるためのテストを実施しましょう。 更新頻度の低いデプロイについては、運用テストを定期的なメンテナンスの一環としてスケジュールします。

**パフォーマンス テストを自動化してパフォーマンスの問題を早期に把握する。** 深刻なパフォーマンスの問題は、コードのバグと同じくらい重大な影響をもたらすことがあります。 自動化された機能テストによってアプリケーションのバグは回避できますが、パフォーマンスの問題は検出できない可能性があります。 待ち時間、読み込み時間、リソース使用量など、各種のメトリックに関して、許容できるパフォーマンス目標を定義してください。 自動化されたパフォーマンス テストをリリース パイプラインに含めて、それらの目標をアプリケーションが満たしていることを確認します。

**キャパシティ テストを実施する。** テスト条件下ではアプリケーションが正常に機能するものの、スケーラビリティやリソースの制限上、運用環境では問題が生じることがあります。 想定される最大のキャパシティと使用量の上限を必ず定義しましょう。 それらの上限にアプリケーションが対応できることをテストで確認するだけでなく、上限を超えたときに何が起こるかをテストしてください。 キャパシティ テストは定期的に実施する必要があります。

初回リリース後、運用環境のコードを更新する際は必ずパフォーマンス テストとキャパシティ テストを実施することをお勧めします。 履歴データを使ってテストを微調整し、実施する必要のあるテストの種類を特定します。

**自動化されたセキュリティ侵入テストを実施する。** アプリケーションのセキュリティを確保することは、他の機能をテストすることと同じくらい大切です。 自動化された侵入テストを、標準的なビルドおよびデプロイ プロセスの一環として実施してください。 デプロイしたアプリケーションに対して定期的なセキュリティ テストと脆弱性スキャンをスケジュールし、開放ポート、エンドポイント、攻撃を監視します。 自動化されたテストによって、定期的に実施する詳細なセキュリティ レビューが不要になるわけではありません。

**自動化されたビジネス継続性テストを実施する。** バックアップの回復とフェールオーバーを含む大規模なビジネス継続性のテストを作成します。 自動化されたプロセスを設けて、それらのテストを定期的に実施しましょう。

## <a name="release"></a>Release

**デプロイを自動化する。** テスト環境、ステージング環境、運用環境へのアプリケーションのデプロイを自動化します。 自動化することによってデプロイの期間が短縮され、信頼性が向上するほか、サポートされるすべての環境でデプロイの一貫性が確保されます。 手動でデプロイすることによって生じる人為的ミスのリスクを取り除くことができます。 また、都合に応じたリリース スケジュールが立てやすくなるので、ダウンタイムが生じた場合の影響を最小限に抑えることができます。

**継続的インテグレーションを使用する。** 継続的インテグレーション (CI) は、一元化されたコードベースに対し、開発者のすべてのコードを定期的にマージし、標準的なビルド プロセスとテスト プロセスを自動的に実行する手法です。 CI によって、不整合を生じることなくチーム全体が同時にコードベースの作業に取り組むことができます。 コードの欠陥も、早い段階で確実に発見することが可能です。 できれば CI プロセスは、コードをコミットするときやチェックインするときに毎回実行することをお勧めします。 少なくとも 1 日に 1 回は実行してください。

> [トランク ベースの開発モデル][trunk-based]の採用を検討してください。 このモデルでは、開発者たちが単一のブランチ (トランク) に対してコミットします。 その要件として、コミットによってビルドに支障が生じない、ということがあります。 このモデルでは、すべての機能の作業がトランク内で実行され、マージの競合が生じてもコミット時に解決されるため、CI が円滑化されます。

**継続的配信の使用を検討する。** 継続的配信 (CD) は、運用環境と同様の環境に対してコードのビルド、テスト、デプロイを自動的に行うことで常時デプロイ可能なコードを確保する手法です。 継続的配信を追加して CI/CD の完全なパイプラインを形成することで、コードの欠陥を早期に検出しやすくなり、適切にテストされた更新プログラムをごく短期間でリリースすることができます。

> 継続的 "*デプロイ*" は、CI/CD パイプラインを経た更新プログラムを自動的に取得して運用環境にデプロイする追加のプロセスです。 継続的デプロイは、堅牢な自動テストと高度なプロセス計画を必要とし、すべてのチームに適しているとは限りません。

**少しずつ漸進的な変更を行う。** 大規模なコード変更を行うと、バグが発生する可能性が高くなります。 可能な限り、変更は小さいものに留めてください。 そうすることで、個々の変更によって影響が生じる可能性を抑え、問題の把握とデバッグがしやすくなります。

**変更の公開を管理する。** 更新プログラムがエンド ユーザーの目に触れるタイミングを確実に管理しましょう。 フィーチャー トグルを使用して、エンド ユーザーが機能を利用できるようになるタイミングを管理することを検討してください。

**リリース管理戦略を導入してデプロイのリスクを軽減する。** アプリケーションの更新プログラムを運用環境にデプロイする際には、常にある程度のリスクが伴います。 そのリスクを最小限に抑えるために、[カナリア リリース][canary-release]や [Blue-Green デプロイ][blue-green]などの戦略を使って更新プログラムを一部のユーザーにデプロイするようにします。 想定したとおりに更新プログラムが動作することを確認したうえで、残りのシステムに更新プログラムをロールアウトしてください。

**すべての変更を文書化する。** 軽微な更新や構成の変更が、混乱やバージョン管理の競合を引き起こす原因となる場合があります。 いかに小さな変更でも必ず、明確な記録を残すようにしましょう。 適用したパッチ、ポリシーの変更、構成の変更など、生じた変更はすべて記録してください。 (ただし、それらのログには機密データを含めないようにしてください。 たとえば、資格情報が更新された事実や、変更を加えたユーザーは記録しますが、更新後の資格情報は記録しないでください。)変更の記録をチーム全員が閲覧できるようにしてください。 

**デプロイを自動化する。** すべてのデプロイを自動化し、ロールアウト中に問題を検出するためのシステムを設置します。 すべての運用環境インスタンスのコードとデータを更新によって置き換える前に、リスク軽減のためのプロセスとして、運用環境にある既存のコードとデータを残すようにしましょう。 修正プログラムをロールフォワードしたり変更をロールバックしたりするための自動化された手段を用意してください。

**インフラストラクチャをイミュータブルにすることを検討する。** イミュータブル インフラストラクチャは、運用環境にデプロイした後にインフラストラクチャを変更すべきではないという原則です。 そうしないと、場当たりの変更が適用され、変更内容を正確に把握しづらくなる可能性があります。 イミュータブル インフラストラクチャは、新しいデプロイの一環として、サーバー全体を置き換えることによって実現されます。 そうすることで、コードとそのホストとなる環境を 1 つのブロックとしてテストし、デプロイすることができます。 いったんデプロイしたインフラストラクチャ コンポーネントは、次のビルド/デプロイ サイクルまで変更されません。 

## <a name="monitoring"></a>監視

**システムを監視可能にする。** 運用チームは、システムやサービスの正常性と状態を絶えず明確に把握しておく必要があります。 状態を監視するための外部の正常性エンドポイントをセットアップすると共に、運用上のメトリックをインストルメント化するようアプリケーションをコーディングしてください。 システムの枠を越えてイベントを相互に関連付けることができる一般的かつ一貫性のあるスキーマを使用しましょう。 [Azure 診断][azure-diagnostics]や [Application Insights][app-insights] は、Azure のリソースの正常性と状態を追跡する標準的な手法です。 また、Microsoft [Operation Management Suite][oms] を通じて、クラウド ソリューションまたはハイブリッド ソリューションのための一元化された監視と管理の機能を利用することもできます。

**ログとメトリックを集計して相互に関連付ける。** 適切にインストルメント化されたテレメトリ システムからは、生のパフォーマンス データとイベント ログが大量に生成されます。 テレメトリ データとログ データの処理と相互の関連付けが短時間で実行され、システムの正常性に関して、常に最新の情報を運用スタッフが把握できることを確認してください。 問題の全体像が把握できるようにデータを整理して表示し、イベントが互いに関連している場合にはそれが可能な限り明らかになるようにします。

> データの処理方法と必要な保持期間に関する要件については、会社の保持ポリシーを参照してください。 

**自動化されたアラートと通知を実装する。** 問題の発生またはそのリスクを示すパターンや条件を検出して、その問題に対応できるチーム メンバーにアラートを送信する監視ツール ([Azure Monitor][azure-monitor] など) を設定します。 誤検知を避けるためにアラートは調整しましょう。

**資産とリソースの有効期限を監視する。** 証明書などの一部のリソースと資産は、一定期間が経過すると有効期限が切れます。 有効期限の切れる資産と具体的な期限、その資産に依存しているサービスまたは機能を確実に追跡してください。 これらの資産は、自動化されたプロセスを使用して監視します。 資産の有効期限が切れる前に運用チームに伝え、有効期限によってアプリケーションの中断が生じるおそれがあるかどうかをエスカレートしてください。

## <a name="management"></a>管理

**運用タスクを自動化する。** 反復的な運用プロセスを手動で処理していると、間違いが生じやすくなります。 一定の実行と品質を確保するために、そうしたタスクはできる限り自動化しましょう。 その自動化を実装するコードは、ソース管理でバージョン管理することをお勧めします。 他のあらゆるコードと同様、自動化ツールはテストする必要があります。

**コードとしてのインフラストラクチャのアプローチをプロビジョニングに採用する。** リソースのプロビジョニングに必要な手動による構成は、できるだけ少なくしましょう。 スクリプトや [Azure Resource Manager][resource-manager] テンプレートを使うようにします。 スクリプトとテンプレートは、保守の対象となる他のすべてのコードと同様にソース管理してください。 

**コンテナーの使用を検討する。** コンテナーには、アプリケーションをデプロイするための標準的なパッケージベースのインターフェイスが用意されています。 コンテナーを使用した場合、アプリケーションは、その実行に必要なソフトウェアや依存関係、ファイルなどをすべて含んだ自己完結型のパッケージを使用してデプロイされるため、デプロイ プロセスが大幅に省力化されます。 

また、アプリケーションとその基盤となるオペレーティング システムとの間に抽象化レイヤーが形成され、環境間の一貫性が確保されます。 また、この抽象化によって、ホスト上で実行されている他のプロセスやアプリケーションからコンテナーを分離することができます。 

**回復性と自己復旧機能を実装する。** 回復性は、障害から回復するアプリケーションの能力です。 回復性の方法には、たとえば一時的なエラーの再試行やセカンダリ インスタンス (場合によっては別のリージョン) へのフェールオーバーがあります。 詳細については、「[回復性に優れた Azure 用アプリケーションの設計][resiliency]」を参照してください。 問題を即座に把握して機能停止などのシステム障害に対処できるよう、アプリケーションをインストルメント化しましょう。

**運用マニュアルを用意する。** 運用マニュアルまたは "*運用指示書*" は、運用スタッフがシステムを保守するために必要な手順や管理情報を文書化したものです。 その他あらゆる運用シナリオが文書化されるほか、サービスの障害など、中断が生じたときに役に立つ軽減計画も文書化されます。 この文書を開発プロセスの段階で作成し、以後、最新の状態に保つようにします。 これは随時更新される文書であり、定期的な見直し、テスト、改善が必要となります。 

文書が共有されることがきわめて重要となります。 各自が持つ知識を提供し、共有するようチーム メンバーに奨励してください。 チーム全員が文書にアクセスできることが必要です。 チームのメンバーのだれもが簡単に文書を更新できるようにしてください。

**オンコール手順を文書化する。** オンコールの職務、スケジュール、手順を確実に文書化し、すべてのチーム メンバーと共有します。 この情報は常に最新に保つようにしてください。

**サードパーティの依存関係のエスカレーション手順を文書化する。** 直接制御できない外部のサードパーティ サービスにアプリケーションが依存している場合、機能停止への対応計画を立てる必要があります。 計画した軽減プロセスの文書を作成しましょう。 サポートの連絡先とエスカレーション パスを含めるようにしてください。

**構成管理を使用する。** 構成の変更は、計画されていること、運用の視点から明確であること、そして記録されていることが大切です。 これは、構成管理データベース、またはコードとしての構成のアプローチとして具現化することができます。 実際に必要な構成が実施されていることを確かめるために、構成は定期的に監査する必要があります。

**Azure サポート プランを取得し、そのプロセスを理解する。** Azure には、さまざまな[サポート プラン][azure-support-plans]が用意されています。 ニーズに適したプランを選び、その利用方法をチームの全員が確実に理解する必要があります。 チームのメンバーがプランについて細部まで理解し、サポート プロセスの具体的な流れや、Azure のサポート チケットを申請する方法を把握していることが大切です。 大きなイベントが予測される場合は、サービス制限の引き上げを Azure サポートにご相談ください。 詳細については、「[Azure サポートに関する FAQ](https://azure.microsoft.com/en-us/support/faq/)」を参照してください。

**リソースへのアクセス権を付与する際は最小限の特権の原則に従う。** リソースへのアクセス権は慎重に管理してください。 既定では、リソースへのアクセス権がユーザーに対して明示的に付与されていない限り、アクセスは拒否されます。 ユーザーに付与するアクセス権は、各自のタスクを遂行するうえで必要な範囲に限定しましょう。 ユーザーのアクセス許可を追跡し、定期的にセキュリティ監査を実施してください。

**ロールベースのアクセス制御を使用する。** リソースへのユーザー アカウントとアクセス権の割り当てを手動のプロセスで実施することは避けてください。 [Azure Active Directory][azure-ad] の ID とグループに基づく[ロールベースのアクセス制御][rbac] (RBAC) を使用してアクセス権を付与します。 

**バグ追跡システムを使用して問題を追跡する。** 適切な方法で問題を追跡しないと、すぐに見落としや重複する作業、別の問題につながります。 担当者どうしの略式のやり取りで、バグの状態を追跡することは避けてください。 バグ追跡ツールを使って問題の詳細を記録し、それに対応するリソースを割り当て、進行状況や状態の監査証跡を残すようにしましょう。 

**すべてのリソースを変更管理システムで管理する。** DevOps プロセスの要素はどのようなものであれ、管理およびバージョン管理のシステムに追加することをお勧めします。それにより、変更の追跡と監査を容易に行えます。 そのような要素としては、コード、インフラストラクチャ、構成、ドキュメント、スクリプトなどがあります。 テスト/ビルド/レビュー プロセスの最初から最後まで、こうした種類のリソースをすべてコードとして扱います。 

**チェックリストを使用する。** 運用チェックリストを作成してプロセスの遵守を徹底します。 大きなマニュアルでは、どうしても見落としが生じます。遵守すべきチェックリストを用意することで、見過ごされがちな細かな部分にまで強く、注意を喚起することができます。 チェックリストはメンテナンスしてください。タスクを自動化してプロセスを合理化する方法がないか、絶えず模索するようにしましょう。

DevOps の詳細については、Visual Studio サイトの「[DevOps とは?][what-is-devops]」を参照してください。

<!-- links -->

[app-insights]: /azure/application-insights/
[azure-ad]: https://azure.microsoft.com/services/active-directory/
[azure-diagnostics]: /azure/monitoring-and-diagnostics/azure-diagnostics
[azure-monitor]: /azure/monitoring-and-diagnostics/monitoring-overview
[azure-support-plans]: https://azure.microsoft.com/support/plans/
[blue-green]: https://martinfowler.com/bliki/BlueGreenDeployment.html
[canary-release]:https://martinfowler.com/bliki/CanaryRelease.html
[dev-test]: https://azure.microsoft.com/solutions/dev-test/
[feature-toggles]: https://www.martinfowler.com/articles/feature-toggles.html
[oms]: https://www.microsoft.com/cloud-platform/operations-management-suite
[rbac]: /azure/active-directory/role-based-access-control-what-is
[resiliency]: ../resiliency/index.md
[resource-manager]: /azure/azure-resource-manager/
[trunk-based]: https://trunkbaseddevelopment.com/
[what-is-devops]: https://www.visualstudio.com/learn/what-is-devops/
