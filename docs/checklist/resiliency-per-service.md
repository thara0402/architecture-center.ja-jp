---
title: Azure サービスの回復性のチェックリスト
description: さまざまな Azure サービスの回復性のガイダンスを提供するチェックリストです。
author: petertaylor9999
ms.date: 03/02/2018
ms.custom: resiliency, checklist
ms.openlocfilehash: 50808a837132e905cc89c3c43d40852a04f4885c
ms.sourcegitcommit: dbbf914757b03cdee7a274204f9579fa63d7eed2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2018
ms.locfileid: "50916704"
---
# <a name="resiliency-checklist-for-specific-azure-services"></a><span data-ttu-id="4a150-103">特定の Azure サービスの回復性のチェックリスト</span><span class="sxs-lookup"><span data-stu-id="4a150-103">Resiliency checklist for specific Azure services</span></span>

<span data-ttu-id="4a150-104">回復性とは、障害から回復して引き続き機能するシステムの能力であり、[ソフトウェア品質の重要な要素](../guide/pillars.md)の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="4a150-104">Resiliency is the ability of a system to recover from failures and continue to function, and is one of the [pillars of software quality](../guide/pillars.md).</span></span> <span data-ttu-id="4a150-105">各テクノロジには独自の障害モードがあり、アプリケーションの設計および実装の際に考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-105">Every technology has its own particular failure modes, which you must consider when designing and implementing your application.</span></span> <span data-ttu-id="4a150-106">このチェックリストを使用して、個々の Azure サービスの回復性の考慮事項を確認します。</span><span class="sxs-lookup"><span data-stu-id="4a150-106">Use this checklist to review the resiliency considerations for specific Azure services.</span></span> <span data-ttu-id="4a150-107">また、[一般的な回復性のチェックリスト](./resiliency.md)も確認します。</span><span class="sxs-lookup"><span data-stu-id="4a150-107">Also review the [general resiliency checklist](./resiliency.md).</span></span>

## <a name="app-service"></a><span data-ttu-id="4a150-108">App Service</span><span class="sxs-lookup"><span data-stu-id="4a150-108">App Service</span></span>

<span data-ttu-id="4a150-109">**Standard または Premium レベルを使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-109">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="4a150-110">これらの階層は、ステージング スロットと自動バックアップをサポートします。</span><span class="sxs-lookup"><span data-stu-id="4a150-110">These tiers support staging slots and automated backups.</span></span> <span data-ttu-id="4a150-111">詳細については、「[Azure App Service プランの詳細な概要](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)」を参照してください</span><span class="sxs-lookup"><span data-stu-id="4a150-111">For more information, see [Azure App Service plans in-depth overview](/azure/app-service/azure-web-sites-web-hosting-plans-in-depth-overview/)</span></span>

<span data-ttu-id="4a150-112">**スケールアップまたはスケールダウンを回避します｡**</span><span class="sxs-lookup"><span data-stu-id="4a150-112">**Avoid scaling up or down.**</span></span> <span data-ttu-id="4a150-113">代わりに、通常の負荷の下でパフォーマンスの要件を満たす階層とインスタンスのサイズを選択してから、インスタンスを[スケールアウト](/azure/app-service-web/web-sites-scale/)してトラフィック量の変化を処理してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-113">Instead, select a tier and instance size that meet your performance requirements under typical load, and then [scale out](/azure/app-service-web/web-sites-scale/) the instances to handle changes in traffic volume.</span></span> <span data-ttu-id="4a150-114">スケールアップとスケールダウンにより、アプリケーションの再起動がトリガーされることがあります。</span><span class="sxs-lookup"><span data-stu-id="4a150-114">Scaling up and down may trigger an application restart.</span></span>  

<span data-ttu-id="4a150-115">**構成をアプリ設定として格納します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-115">**Store configuration as app settings.**</span></span> <span data-ttu-id="4a150-116">アプリ設定を使用して、構成設定をアプリケーション設定として格納してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-116">Use app settings to hold configuration settings as app settings.</span></span> <span data-ttu-id="4a150-117">Resource Manager テンプレートに、または PowerShell 使用して設定を定義して、それを自動化されたデプロイや更新プロセスの一部として適用できるようにしてください。それによって信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="4a150-117">Define the settings in your Resource Manager templates, or using PowerShell, so that you can apply them as part of an automated deployment / update process, which is more reliable.</span></span> <span data-ttu-id="4a150-118">詳細については、「[Azure App Service での Web アプリの構成](/azure/app-service-web/web-sites-configure/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-118">For more information, see [Configure web apps in Azure App Service](/azure/app-service-web/web-sites-configure/).</span></span>

<span data-ttu-id="4a150-119">**運用とテスト用に別々の App Service プランを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-119">**Create separate App Service plans for production and test.**</span></span> <span data-ttu-id="4a150-120">テストには運用環境のデプロイのスロットを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="4a150-120">Don't use slots on your production deployment for testing.</span></span>  <span data-ttu-id="4a150-121">同じ App Service プラン内のすべてのアプリが同じ VM インスタンスを共有します。</span><span class="sxs-lookup"><span data-stu-id="4a150-121">All apps within the same App Service plan share the same VM instances.</span></span> <span data-ttu-id="4a150-122">運用デプロイとテスト デプロイを同じプランに入れると、運用デプロイに悪影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-122">If you put production and test deployments in the same plan, it can negatively affect the production deployment.</span></span> <span data-ttu-id="4a150-123">たとえば、負荷テストは実稼働の運用サイトを低下させる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-123">For example, load tests might degrade the live production site.</span></span> <span data-ttu-id="4a150-124">テスト デプロイを別のプランに入れることで、運用バージョンから分離してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-124">By putting test deployments into a separate plan, you isolate them from the production version.</span></span>  

<span data-ttu-id="4a150-125">**Web アプリから Web API を分離します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-125">**Separate web apps from web APIs.**</span></span> <span data-ttu-id="4a150-126">ソリューションに Web フロントエンドと Web API の両方がある場合は、それらを別々の App Service アプリに分解することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-126">If your solution has both a web front-end and a web API, consider decomposing them into separate App Service apps.</span></span> <span data-ttu-id="4a150-127">この設計により、ソリューションをワークロード別に分解しやすくなります。</span><span class="sxs-lookup"><span data-stu-id="4a150-127">This design makes it easier to decompose the solution by workload.</span></span> <span data-ttu-id="4a150-128">Web アプリと API を別々の App Service プランで実行できるため、それらを個別にスケーリングできるようになります。</span><span class="sxs-lookup"><span data-stu-id="4a150-128">You can run the web app and the API in separate App Service plans, so they can be scaled independently.</span></span> <span data-ttu-id="4a150-129">最初はこのレベルのスケーラビリティが不要な場合は、アプリを同じプランにデプロイし、後で必要に応じて別のプランに移行することができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-129">If you don't need that level of scalability at first, you can deploy the apps into the same plan, and move them into separate plans later, if needed.</span></span>

<span data-ttu-id="4a150-130">**Azure SQL データベースをバックアップするのに App Service バックアップ機能を使用しないでください。**</span><span class="sxs-lookup"><span data-stu-id="4a150-130">**Avoid using the App Service backup feature to back up Azure SQL databases.**</span></span> <span data-ttu-id="4a150-131">代わりに、[SQL Database 自動バックアップ][sql-backup]を使用してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-131">Instead, use [SQL Database automated backups][sql-backup].</span></span> <span data-ttu-id="4a150-132">App Service のバックアップはデータベースを SQL .bacpac ファイルにエクスポートし、これには DTU のコストがかかります。</span><span class="sxs-lookup"><span data-stu-id="4a150-132">App Service backup exports the database to a SQL .bacpac file, which costs DTUs.</span></span>  

<span data-ttu-id="4a150-133">**ステージング スロットにデプロイします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-133">**Deploy to a staging slot.**</span></span> <span data-ttu-id="4a150-134">ステージング用のデプロイ スロットを作成します。</span><span class="sxs-lookup"><span data-stu-id="4a150-134">Create a deployment slot for staging.</span></span> <span data-ttu-id="4a150-135">アプリケーションの更新プログラムをステージング スロットにデプロイし、運用環境にスワップする前にデプロイを確認してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-135">Deploy application updates to the staging slot, and verify the deployment before swapping it into production.</span></span> <span data-ttu-id="4a150-136">これにより、運用環境で不正な更新が発生する可能性が減少します。</span><span class="sxs-lookup"><span data-stu-id="4a150-136">This reduces the chance of a bad update in production.</span></span> <span data-ttu-id="4a150-137">また、すべてのインスタンスが、運用環境にスワップする前に確実にウォーム アップされます。</span><span class="sxs-lookup"><span data-stu-id="4a150-137">It also ensures that all instances are warmed up before being swapped into production.</span></span> <span data-ttu-id="4a150-138">多くのアプリケーションではウォームアップとコールドスタートに多くの時間がかかります。</span><span class="sxs-lookup"><span data-stu-id="4a150-138">Many applications have a significant warmup and cold-start time.</span></span> <span data-ttu-id="4a150-139">詳細については、「[Azure App Service の Web アプリのステージング環境を設定する](/azure/app-service-web/web-sites-staged-publishing/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-139">For more information, see [Set up staging environments for web apps in Azure App Service](/azure/app-service-web/web-sites-staged-publishing/).</span></span>

<span data-ttu-id="4a150-140">**前回正常起動時 (LKG) のデプロイを保持するデプロイ スロットを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-140">**Create a deployment slot to hold the last-known-good (LKG) deployment.**</span></span> <span data-ttu-id="4a150-141">運用環境に更新プログラムをデプロイするときは、以前の運用環境のデプロイを LKG スロットに移動してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-141">When you deploy an update to production, move the previous production deployment into the LKG slot.</span></span> <span data-ttu-id="4a150-142">これにより、不適切なデプロイをより簡単にロールバックできます。</span><span class="sxs-lookup"><span data-stu-id="4a150-142">This makes it easier to roll back a bad deployment.</span></span> <span data-ttu-id="4a150-143">後で問題を見つけた場合は、LKG バージョンにすばやく戻ることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-143">If you discover a problem later, you can quickly revert to the LKG version.</span></span> <span data-ttu-id="4a150-144">詳細については、[基本的な Web アプリケーション](../reference-architectures/app-service-web-app/basic-web-app.md)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-144">For more information, see [Basic web application](../reference-architectures/app-service-web-app/basic-web-app.md).</span></span>

<span data-ttu-id="4a150-145">アプリケーションのログ記録や Web サーバーのログ記録を含む、**診断のログ記録を有効にしてください**。</span><span class="sxs-lookup"><span data-stu-id="4a150-145">**Enable diagnostics logging**, including application logging and web server logging.</span></span> <span data-ttu-id="4a150-146">監視と診断にはログ記録が重要です。</span><span class="sxs-lookup"><span data-stu-id="4a150-146">Logging is important for monitoring and diagnostics.</span></span> <span data-ttu-id="4a150-147">「[Azure App Service での Web アプリの診断ログの有効化](/azure/app-service-web/web-sites-enable-diagnostic-log/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-147">See [Enable diagnostics logging for web apps in Azure App Service](/azure/app-service-web/web-sites-enable-diagnostic-log/)</span></span>

<span data-ttu-id="4a150-148">**Blob Storage にログを記録します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-148">**Log to blob storage.**</span></span> <span data-ttu-id="4a150-149">これによって、データの収集と分析が簡単になります。</span><span class="sxs-lookup"><span data-stu-id="4a150-149">This makes it easier to collect and analyze the data.</span></span>

<span data-ttu-id="4a150-150">**ログ用の別のストレージ アカウントを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-150">**Create a separate storage account for logs.**</span></span> <span data-ttu-id="4a150-151">ログとアプリケーション データに同じストレージ アカウントを使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="4a150-151">Don't use the same storage account for logs and application data.</span></span> <span data-ttu-id="4a150-152">これは、ログ記録によってアプリケーションのパフォーマンスが低下するのを防ぐのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="4a150-152">This helps to prevent logging from reducing application performance.</span></span>

<span data-ttu-id="4a150-153">**パフォーマンスを監視します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-153">**Monitor performance.**</span></span> <span data-ttu-id="4a150-154">[New Relic](https://newrelic.com/) や[Application Insights](/azure/application-insights/app-insights-overview/) などのパフォーマンス監視サービスを使用して、負荷がかかった状態のアプリケーションのパフォーマンスと動作を監視してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-154">Use a performance monitoring service such as [New Relic](https://newrelic.com/) or [Application Insights](/azure/application-insights/app-insights-overview/) to monitor application performance and behavior under load.</span></span>  <span data-ttu-id="4a150-155">パフォーマンスの監視により、アプリケーションをリアルタイムで理解できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-155">Performance monitoring gives you real-time insight into the application.</span></span> <span data-ttu-id="4a150-156">これにより、問題を診断し、障害の根本原因分析を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-156">It enables you to diagnose issues and perform root-cause analysis of failures.</span></span>

## <a name="application-gateway"></a><span data-ttu-id="4a150-157">Application Gateway</span><span class="sxs-lookup"><span data-stu-id="4a150-157">Application Gateway</span></span>

<span data-ttu-id="4a150-158">**少なくとも 2 つのインスタンスをプロビジョニングします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-158">**Provision at least two instances.**</span></span> <span data-ttu-id="4a150-159">少なくとも 2 つのインスタンスのある Application Gateway をデプロイしてください。</span><span class="sxs-lookup"><span data-stu-id="4a150-159">Deploy Application Gateway with at least two instances.</span></span> <span data-ttu-id="4a150-160">単一のインスタンスは、単一障害点です。</span><span class="sxs-lookup"><span data-stu-id="4a150-160">A single instance is a single point of failure.</span></span> <span data-ttu-id="4a150-161">冗長性とスケーラビリティのために、2 つ以上のインスタンスを使用してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-161">Use two or more instances for redundancy and scalability.</span></span> <span data-ttu-id="4a150-162">[SLA](https://azure.microsoft.com/support/legal/sla/application-gateway) に適合するためには、2 つ以上のメディアまたは大きめのインスタンスをプロビジョニングする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-162">In order to qualify for the [SLA](https://azure.microsoft.com/support/legal/sla/application-gateway), you must provision two or more medium or larger instances.</span></span>

## <a name="cosmos-db"></a><span data-ttu-id="4a150-163">Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="4a150-163">Cosmos DB</span></span>

<span data-ttu-id="4a150-164">**リージョン間でデータベースをレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-164">**Replicate the database across regions.**</span></span> <span data-ttu-id="4a150-165">Cosmos DB では、Cosmos DB データベース アカウントに Azure リージョンをいくつでも関連付けることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-165">Cosmos DB allows you to associate any number of Azure regions with a Cosmos DB database account.</span></span> <span data-ttu-id="4a150-166">Cosmos DB データベースには、1 つの書き込みリージョンと複数の読み取りリージョンを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-166">A Cosmos DB database can have one write region and multiple read regions.</span></span> <span data-ttu-id="4a150-167">書き込みリージョンに障害がある場合は、別のレプリカから読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-167">If there is a failure in the write region, you can read from another replica.</span></span> <span data-ttu-id="4a150-168">クライアント SDK はこれを自動的に処理します。</span><span class="sxs-lookup"><span data-stu-id="4a150-168">The Client SDK handles this automatically.</span></span> <span data-ttu-id="4a150-169">書き込みリージョンを別のリージョンにフェールオーバーすることもできます。</span><span class="sxs-lookup"><span data-stu-id="4a150-169">You can also fail over the write region to another region.</span></span> <span data-ttu-id="4a150-170">詳細については、「[Azure Cosmos DB を使用してデータをグローバルに分散させる方法](/azure/cosmos-db/distribute-data-globally)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-170">For more information, see [How to distribute data globally with Azure Cosmos DB](/azure/cosmos-db/distribute-data-globally).</span></span>

## <a name="event-hubs"></a><span data-ttu-id="4a150-171">Event Hubs</span><span class="sxs-lookup"><span data-stu-id="4a150-171">Event Hubs</span></span>

<span data-ttu-id="4a150-172">**チェックポイントを使用します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-172">**Use checkpoints**.</span></span>  <span data-ttu-id="4a150-173">イベント コンシューマーは、事前定義された間隔で永続的ストレージに現在位置を書き込む必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-173">An event consumer should write its current position to persistent storage at some predefined interval.</span></span> <span data-ttu-id="4a150-174">このように、コンシューマーで障害が発生した場合 (たとえば、コンシューマーがクラッシュした場合や、ホストに障害が発生した場合)、新しいインスタンスは最後に記録された位置からストリームの読み取りを再開できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-174">That way, if the consumer experiences a fault (for example, the consumer crashes, or the host fails), then a new instance can resume reading the stream from the last recorded position.</span></span> <span data-ttu-id="4a150-175">詳細については、[イベント コンシューマー](/azure/event-hubs/event-hubs-features#event-consumers)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-175">For more information, see [Event consumers](/azure/event-hubs/event-hubs-features#event-consumers).</span></span>

<span data-ttu-id="4a150-176">**重複メッセージを処理します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-176">**Handle duplicate messages.**</span></span> <span data-ttu-id="4a150-177">イベント コンシューマーに障害が発生すると、メッセージの処理は最後に記録されたチェックポイントから再開されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-177">If an event consumer fails, message processing is resumed from the last recorded checkpoint.</span></span> <span data-ttu-id="4a150-178">最後のチェックポイントの後で既に処理されたメッセージはすべて、再度処理されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-178">Any messages that were already processed after the last checkpoint will be processed again.</span></span> <span data-ttu-id="4a150-179">したがって、メッセージ処理ロジックがべき等であるか、アプリケーションでメッセージの重複を除去できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-179">Therefore, your message processing logic must be idempotent, or the application must be able to deduplicate messages.</span></span>

<span data-ttu-id="4a150-180">**例外を処理します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-180">**Handle exceptions.**.</span></span> <span data-ttu-id="4a150-181">イベント コンシューマーは、通常、ループ内のメッセージをバッチで処理します。</span><span class="sxs-lookup"><span data-stu-id="4a150-181">An event consumer typically processes a batch of messages in a loop.</span></span> <span data-ttu-id="4a150-182">1 つのメッセージによって例外が発生した場合は、メッセージのバッチ全体を失わないように、その処理ループ内の例外を処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-182">You should handle exceptions within this processing loop to avoid losing an entire batch of messages if a single message causes an exception.</span></span>

<span data-ttu-id="4a150-183">**配信不能キューを使用します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-183">**Use a dead-letter queue.**</span></span> <span data-ttu-id="4a150-184">メッセージを処理した結果、一時的でないエラーが発生した場合は、状態を追跡できるように、メッセージを配信不能キューに配置します。</span><span class="sxs-lookup"><span data-stu-id="4a150-184">If processing a message results in a non-transient failure, put the message onto a dead-letter queue, so that you can track the status.</span></span> <span data-ttu-id="4a150-185">シナリオによっては、メッセージを後で再試行したり、補正トランザクションを適用したり、他の何らかのアクションを実行したりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-185">Depending on the scenario, you might retry the message later, apply a compensating transaction, or take some other action.</span></span> <span data-ttu-id="4a150-186">Event Hubs には、組み込みの配信不能キュー機能がないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-186">Note that Event Hubs does not have any built-in dead-letter queue functionality.</span></span> <span data-ttu-id="4a150-187">Azure Queue Storage または Service Bus を使用して配信不能キューを実装したり、Azure Functions またはその他のイベント処理メカニズムを使用したりすることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-187">You can use Azure Queue Storage or Service Bus to implement a dead-letter queue, or use Azure Functions or some other eventing mechanism.</span></span>  

<span data-ttu-id="4a150-188">**セカンダリ Event Hubs 名前空間にフェールオーバーして、ディザスター リカバリーを実装します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-188">**Implement disaster recovery by failing over to a secondary Event Hubs namespace.**</span></span> <span data-ttu-id="4a150-189">詳細については、「[Azure Event Hubs geo ディザスター リカバリー](/azure/event-hubs/event-hubs-geo-dr)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-189">For more information, see [Azure Event Hubs Geo-disaster recovery](/azure/event-hubs/event-hubs-geo-dr).</span></span>

## <a name="redis-cache"></a><span data-ttu-id="4a150-190">Redis Cache</span><span class="sxs-lookup"><span data-stu-id="4a150-190">Redis Cache</span></span>

<span data-ttu-id="4a150-191">**geo レプリケーションを構成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-191">**Configure Geo-replication**.</span></span> <span data-ttu-id="4a150-192">geo レプリケーションは、Premium レベルの Azure Redis Cache の 2 つのインスタンスをリンクするメカニズムを用意しています。</span><span class="sxs-lookup"><span data-stu-id="4a150-192">Geo-replication provides a mechanism for linking two Premium tier Azure Redis Cache instances.</span></span> <span data-ttu-id="4a150-193">プライマリ キャッシュに書き込まれたデータは、読み取り専用のセカンダリ キャッシュにレプリケートされます。</span><span class="sxs-lookup"><span data-stu-id="4a150-193">Data written to the primary cache is replicated to a secondary read-only cache.</span></span> <span data-ttu-id="4a150-194">詳細については、「[Azure Redis Cache の geo レプリケーションの構成方法](/azure/redis-cache/cache-how-to-geo-replication)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-194">For more information, see [How to configure Geo-replication for Azure Redis Cache](/azure/redis-cache/cache-how-to-geo-replication)</span></span>

<span data-ttu-id="4a150-195">**データ永続化を構成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-195">**Configure data persistence.**</span></span> <span data-ttu-id="4a150-196">Redis の永続化を使用すると、Redis に格納されたデータを保持できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-196">Redis persistence allows you to persist data stored in Redis.</span></span> <span data-ttu-id="4a150-197">また、スナップショットを取得したりデータをバックアップしたりして、ハードウェア障害のときに読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-197">You can also take snapshots and back up the data, which you can load in case of a hardware failure.</span></span> <span data-ttu-id="4a150-198">詳細については、「[Premium Azure Redis Cache のデータ永続化の構成方法](/azure/redis-cache/cache-how-to-premium-persistence)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-198">For more information, see [How to configure data persistence for a Premium Azure Redis Cache](/azure/redis-cache/cache-how-to-premium-persistence)</span></span>

<span data-ttu-id="4a150-199">永続ストアとしてではなく、一時的なデータ キャッシュとして Redis Cache を使用する場合、これらの推奨事項は適用されません。</span><span class="sxs-lookup"><span data-stu-id="4a150-199">If you are using Redis Cache as a temporary data cache and not as a persistent store, these recommendations may not apply.</span></span> 

## <a name="search"></a><span data-ttu-id="4a150-200">Search</span><span class="sxs-lookup"><span data-stu-id="4a150-200">Search</span></span>

<span data-ttu-id="4a150-201">**複数のレプリカをプロビジョニングします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-201">**Provision more than one replica.**</span></span> <span data-ttu-id="4a150-202">読み取りの高可用性のためには少なくとも 2 つのレプリカ、読み取り/書き込みの高可用性のためには少なくとも 3 つのレプリカを使用してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-202">Use at least two replicas for read high-availability, or three for read-write high-availability.</span></span>

<span data-ttu-id="4a150-203">**複数リージョンのデプロイ用のインデクサーを構成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-203">**Configure indexers for multi-region deployments.**</span></span> <span data-ttu-id="4a150-204">複数リージョンのデプロイがある場合は、インデックス作成の継続性のためのオプションを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-204">If you have a multi-region deployment, consider your options for continuity in indexing.</span></span>

  * <span data-ttu-id="4a150-205">データ ソースが geo レプリケーションされている場合は、一般に、各リージョンの Azure Search サービスのそれぞれのインデクサーをそのローカル データ ソース レプリカにポイントする必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-205">If the data source is geo-replicated, you should generally point each indexer of each regional Azure Search service to its local data source replica.</span></span> <span data-ttu-id="4a150-206">ただし、このアプローチは、Azure SQL データベースに格納されている大規模なデータセットは推奨されません。</span><span class="sxs-lookup"><span data-stu-id="4a150-206">However, that approach is not recommended for large datasets stored in Azure SQL Database.</span></span> <span data-ttu-id="4a150-207">その理由は、Azure Search がセカンダリ SQL Database レプリカからは増分インデックス作成を実行できず、プライマリ レプリカからしか実行できないためです。</span><span class="sxs-lookup"><span data-stu-id="4a150-207">The reason is that Azure Search cannot perform incremental indexing from secondary SQL Database replicas, only from primary replicas.</span></span> <span data-ttu-id="4a150-208">代わりに、すべてのインデクサーをプライマリ レプリカにポイントしてください。</span><span class="sxs-lookup"><span data-stu-id="4a150-208">Instead, point all indexers to the primary replica.</span></span> <span data-ttu-id="4a150-209">フェールオーバー後は、新しいプライマリ レプリカで Azure Search インデクサーをポイントします。</span><span class="sxs-lookup"><span data-stu-id="4a150-209">After a failover, point the Azure Search indexers at the new primary replica.</span></span>  
  * <span data-ttu-id="4a150-210">データ ソースが geo レプリケートされていない場合は、同じデータ ソースにある複数のインデクサーをポイントして、複数のリージョン内の Azure Search サービスがデータ ソースからのインデックス作成を継続的に単独で行うようにしてください。</span><span class="sxs-lookup"><span data-stu-id="4a150-210">If the data source is not geo-replicated, point multiple indexers at the same data source, so that Azure Search services in multiple regions continuously and independently index from the data source.</span></span> <span data-ttu-id="4a150-211">詳細については、「[Azure Search のパフォーマンスと最適化に関する考慮事項][search-optimization]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-211">For more information, see [Azure Search performance and optimization considerations][search-optimization].</span></span>

## <a name="service-bus"></a><span data-ttu-id="4a150-212">Service Bus</span><span class="sxs-lookup"><span data-stu-id="4a150-212">Service Bus</span></span>

<span data-ttu-id="4a150-213">**運用ワークロードには Premium レベルを使用します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-213">**Use Premium tier for production workloads**.</span></span> <span data-ttu-id="4a150-214">[Service Bus の Premium メッセージング](/azure/service-bus-messaging/service-bus-premium-messaging)では、専用の予約済み処理リソースと、予測可能なパフォーマンスとスループットをサポートするためのメモリ容量が提供されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-214">[Service Bus Premium Messaging](/azure/service-bus-messaging/service-bus-premium-messaging) provides dedicated and reserved processing resources, and memory capacity to support predictable performance and throughput.</span></span> <span data-ttu-id="4a150-215">また、Premium メッセージング レベルでは、Premium のお客様だけがいち早く利用できる新機能にもアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="4a150-215">Premium Messaging tier also gives you access to new features that are available only to premium customers at first.</span></span> <span data-ttu-id="4a150-216">予想されるワークロードに基づいて、メッセージング ユニットの数を決定できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-216">You can decide the number of messaging units based on expected workloads.</span></span>

<span data-ttu-id="4a150-217">**重複メッセージを処理します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-217">**Handle duplicate messages**.</span></span> <span data-ttu-id="4a150-218">メッセージ送信後すぐにパブリッシャーで障害が発生した場合、またはネットワークやシステムで問題が発生した場合は、メッセージが配信されたことをエラーのため記録できないことがあり、同じメッセージがシステムに 2 回送信される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-218">If a publisher fails immediately after sending a message, or experiences network or system issues, it may erroneously fail to record that the message was delivered, and may send the same message to the system twice.</span></span> <span data-ttu-id="4a150-219">Service Bus では、重複の検出を有効にすることで、この問題を処理できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-219">Service Bus can handle this issue by enabling duplicate detection.</span></span> <span data-ttu-id="4a150-220">詳しくは、「[重複検出](/azure/service-bus-messaging/duplicate-detection)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-220">For more information, see [Duplicate detection](/azure/service-bus-messaging/duplicate-detection).</span></span>

<span data-ttu-id="4a150-221">**例外を処理します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-221">**Handle exceptions**.</span></span> <span data-ttu-id="4a150-222">メッセージング API では、ユーザー エラー、構成エラー、その他のエラーが発生すると、例外が生成されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-222">Messaging APIs generate exceptions when a user error, configuration error, or other error occurs.</span></span> <span data-ttu-id="4a150-223">クライアント コード (送信側と受信側) では、コード内でこれらの例外を処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-223">The client code (senders and receivers) should handle these exceptions in their code.</span></span> <span data-ttu-id="4a150-224">バッチ処理では、例外処理を使用してメッセージのバッチ全体が失われるのを防ぐことができるので、特に重要です。</span><span class="sxs-lookup"><span data-stu-id="4a150-224">This is especially important in batch processing, where exception handling can be used to avoid losing an entire batch of messages.</span></span> <span data-ttu-id="4a150-225">詳しくは、「[Service Bus メッセージングの例外](/azure/service-bus-messaging/service-bus-messaging-exceptions)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-225">For more information, see [Service Bus messaging exceptions](/azure/service-bus-messaging/service-bus-messaging-exceptions).</span></span>

<span data-ttu-id="4a150-226">**再試行ポリシー**。</span><span class="sxs-lookup"><span data-stu-id="4a150-226">**Retry policy**.</span></span> <span data-ttu-id="4a150-227">Service Bus を使用すると、アプリケーションに最適な再試行ポリシーを選択できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-227">Service Bus allows you to pick the best retry policy for your applications.</span></span> <span data-ttu-id="4a150-228">既定のポリシーでは、最大 9 回の再試行が許され、待機時間は 30 秒ですが、これをさらに調整できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-228">The default policy is to allow 9 maximum retry attempts, and wait for 30 seconds but this can be further adjusted.</span></span> <span data-ttu-id="4a150-229">詳しくは、[Service Bus の再試行ポリシー](/azure/architecture/best-practices/retry-service-specific#service-bus)に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-229">For more information, see [Retry policy – Service Bus](/azure/architecture/best-practices/retry-service-specific#service-bus).</span></span>

<span data-ttu-id="4a150-230">**配信不能キューを使用します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-230">**Use a dead-letter queue**.</span></span> <span data-ttu-id="4a150-231">複数回再試行しても、メッセージを処理できないか、またはどの受信者にも配信できない場合、メッセージは配信不能キューに移動されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-231">If a message cannot be processed or delivered to any receiver after multiple retries, it is moved to a dead letter queue.</span></span> <span data-ttu-id="4a150-232">配信不能キューからメッセージを読み取り、検査して、問題を修復するプロセスを実装します。</span><span class="sxs-lookup"><span data-stu-id="4a150-232">Implement a process to read messages from the dead letter queue, inspect them, and remediate the problem.</span></span> <span data-ttu-id="4a150-233">シナリオに応じて、そのままのメッセージで再試行したり、メッセージを変更して再試行したり、メッセージを破棄したりします。</span><span class="sxs-lookup"><span data-stu-id="4a150-233">Depending on the scenario, you might retry the message as-is, make changes and retry, or discard the message.</span></span> <span data-ttu-id="4a150-234">詳しくは、「[Service Bus の配信不能キューの概要](/azure/service-bus-messaging/service-bus-dead-letter-queues)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-234">For more information, see [Overview of Service Bus dead-letter queues](/azure/service-bus-messaging/service-bus-dead-letter-queues).</span></span>

<span data-ttu-id="4a150-235">**geo ディザスター リカバリーを使用します**。</span><span class="sxs-lookup"><span data-stu-id="4a150-235">**Use Geo-Disaster Recovery**.</span></span> <span data-ttu-id="4a150-236">geo ディザスター リカバリーを使用すると、Azure リージョン全体またはデータセンターが災害により使用できなくなった場合でも、別のリージョンまたはデータセンターでデータの処理が続けられることが保証されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-236">Geo-disaster recovery ensures that data processing continues to operate in a different region or datacenter if an entire Azure region or datacenter becomes unavailable due to a disaster.</span></span> <span data-ttu-id="4a150-237">詳細については、「[Azure Service Bus の geo ディザスター リカバリー](/azure/service-bus-messaging/service-bus-geo-dr)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-237">For more information, see [Azure Service Bus Geo-disaster recovery](/azure/service-bus-messaging/service-bus-geo-dr).</span></span>


## <a name="storage"></a><span data-ttu-id="4a150-238">Storage</span><span class="sxs-lookup"><span data-stu-id="4a150-238">Storage</span></span>

<span data-ttu-id="4a150-239">**アプリケーション データには、読み取りアクセス geo 冗長ストレージ (RA-GRS)** を使用します。</span><span class="sxs-lookup"><span data-stu-id="4a150-239">**For application data, use read-access geo-redundant storage (RA-GRS).**</span></span> <span data-ttu-id="4a150-240">RA-GRS ストレージは、セカンダリ リージョンにデータをレプリケートし、セカンダリ リージョンからの読み取り専用のアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="4a150-240">RA-GRS storage replicates the data to a secondary region, and provides read-only access from the secondary region.</span></span> <span data-ttu-id="4a150-241">プライマリ リージョンでストレージが停止した場合、アプリケーションはセカンダリ リージョンからデータを読み取ることができます。</span><span class="sxs-lookup"><span data-stu-id="4a150-241">If there is a storage outage in the primary region, the application can read the data from the secondary region.</span></span> <span data-ttu-id="4a150-242">詳細については、「[Azure Storage のレプリケーション](/azure/storage/storage-redundancy/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-242">For more information, see [Azure Storage replication](/azure/storage/storage-redundancy/).</span></span>

<span data-ttu-id="4a150-243">**VM ディスクには、Managed Disks を使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-243">**For VM disks, use Managed Disks.**</span></span> <span data-ttu-id="4a150-244">[Managed Disks][managed-disks] では、ディスクが単一障害点にならないように相互に十分に分離されるため、可用性セットの VM の信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="4a150-244">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="4a150-245">また、Managed Disks はストレージ アカウントで作成した VHD の IOPS 制限の対象ではありません。</span><span class="sxs-lookup"><span data-stu-id="4a150-245">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="4a150-246">詳細については、「[Azure での Windows 仮想マシンの可用性の管理][vm-manage-availability]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-246">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="4a150-247">**Queue Storage では、別のリージョンにバックアップ キューを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-247">**For Queue storage, create a backup queue in another region.**</span></span> <span data-ttu-id="4a150-248">Queue Storage の場合、項目のキューやデキューができないため、読み取り専用レプリカの使用は制限されています。</span><span class="sxs-lookup"><span data-stu-id="4a150-248">For Queue storage, a read-only replica has limited use, because you can't queue or dequeue items.</span></span> <span data-ttu-id="4a150-249">代わりに、別のリージョンのストレージ アカウントにバックアップ キューを作成します。</span><span class="sxs-lookup"><span data-stu-id="4a150-249">Instead, create a backup queue in a storage account in another region.</span></span> <span data-ttu-id="4a150-250">ストレージの障害がある場合、アプリケーションは、プライマリ リージョンが再び使用可能になるまで、バックアップ キューを使用できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-250">If there is a storage outage, the application can use the backup queue, until the primary region becomes available again.</span></span> <span data-ttu-id="4a150-251">したがって、アプリケーションは、引き続き新しい要求を処理できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-251">That way, the application can still process new requests.</span></span>  

## <a name="sql-database"></a><span data-ttu-id="4a150-252">SQL Database</span><span class="sxs-lookup"><span data-stu-id="4a150-252">SQL Database</span></span>

<span data-ttu-id="4a150-253">**Standard または Premium レベルを使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-253">**Use Standard or Premium tier.**</span></span> <span data-ttu-id="4a150-254">これらの階層は、より長いポイントインタイム リストア期間 (35 日間) を提供します。</span><span class="sxs-lookup"><span data-stu-id="4a150-254">These tiers provide a longer point-in-time restore period (35 days).</span></span> <span data-ttu-id="4a150-255">詳細については、「[SQL Database のオプションとパフォーマンス](/azure/sql-database/sql-database-service-tiers/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-255">For more information, see [SQL Database options and performance](/azure/sql-database/sql-database-service-tiers/).</span></span>

<span data-ttu-id="4a150-256">**SQL Database の監査を有効にします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-256">**Enable SQL Database auditing.**</span></span> <span data-ttu-id="4a150-257">監査は、悪意のある攻撃や人的ミスの診断に使用できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-257">Auditing can be used to diagnose malicious attacks or human error.</span></span> <span data-ttu-id="4a150-258">詳細については、「[SQL Database 監査の使用](/azure/sql-database/sql-database-auditing-get-started/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-258">For more information, see [Get started with SQL database auditing](/azure/sql-database/sql-database-auditing-get-started/).</span></span>

<span data-ttu-id="4a150-259">**アクティブ Geo レプリケーションを使用します。** アクティブ Geo レプリケーションを使用して、さまざまなリージョンに読み取り可能なセカンダリ レプリカを作成します。</span><span class="sxs-lookup"><span data-stu-id="4a150-259">**Use Active Geo-Replication** Use Active Geo-Replication to create a readable secondary in a different region.</span></span>  <span data-ttu-id="4a150-260">プライマリ データベースに障害が発生した場合、またはオフラインにする必要がある場合は、セカンダリ データベースへの手動フェールオーバーを実行します。</span><span class="sxs-lookup"><span data-stu-id="4a150-260">If your primary database fails, or simply needs to be taken offline, perform a manual failover to the secondary database.</span></span>  <span data-ttu-id="4a150-261">セカンダリ データベースは、フェールオーバーするまでは読み取り専用のままです。</span><span class="sxs-lookup"><span data-stu-id="4a150-261">Until you fail over, the secondary database remains read-only.</span></span>  <span data-ttu-id="4a150-262">詳細については、「[Azure SQL Database のアクティブ geo レプリケーション](/azure/sql-database/sql-database-geo-replication-overview/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-262">For more information, see [SQL Database Active Geo-Replication](/azure/sql-database/sql-database-geo-replication-overview/).</span></span>

<span data-ttu-id="4a150-263">**シャーディングを使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-263">**Use sharding.**</span></span> <span data-ttu-id="4a150-264">シャーディングを使用して、データベースを水平方向にパーティション分割することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-264">Consider using sharding to partition the database horizontally.</span></span> <span data-ttu-id="4a150-265">シャーディングによって障害を分離できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-265">Sharding can provide fault isolation.</span></span> <span data-ttu-id="4a150-266">詳細については、「[Azure SQL Database によるスケール アウト](/azure/sql-database/sql-database-elastic-scale-introduction/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-266">For more information, see [Scaling out with Azure SQL Database](/azure/sql-database/sql-database-elastic-scale-introduction/).</span></span>

<span data-ttu-id="4a150-267">**人的ミスから復旧するには、ポイントインタイム リストアを使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-267">**Use point-in-time restore to recover from human error.**</span></span>  <span data-ttu-id="4a150-268">ポイントインタイム リストアは、データベースを以前の特定の時点に戻します。</span><span class="sxs-lookup"><span data-stu-id="4a150-268">Point-in-time restore returns your database to an earlier point in time.</span></span> <span data-ttu-id="4a150-269">詳細については、「[データベースの自動バックアップを使用した Azure SQL Database の復旧][sql-restore]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-269">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

<span data-ttu-id="4a150-270">**サービスの停止から復旧するには、geo リストアを使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-270">**Use geo-restore to recover from a service outage.**</span></span> <span data-ttu-id="4a150-271">geo リストアは geo 冗長バックアップからデータベースを復元します。</span><span class="sxs-lookup"><span data-stu-id="4a150-271">Geo-restore restores a database from a geo-redundant backup.</span></span>  <span data-ttu-id="4a150-272">詳細については、「[データベースの自動バックアップを使用した Azure SQL Database の復旧][sql-restore]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-272">For more information, see [Recover an Azure SQL database using automated database backups][sql-restore].</span></span>

## <a name="sql-data-warehouse"></a><span data-ttu-id="4a150-273">SQL Data Warehouse</span><span class="sxs-lookup"><span data-stu-id="4a150-273">SQL Data Warehouse</span></span>

<span data-ttu-id="4a150-274">**geo バックアップを無効にしないでください。**</span><span class="sxs-lookup"><span data-stu-id="4a150-274">**Do not disable geo-backup.**</span></span> <span data-ttu-id="4a150-275">既定では、SQL Data Warehouse により、ディザスター リカバリー用にデータの完全バックアップが 24 時間ごとに作成されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-275">By default, SQL Data Warehouse takes a full backup of your data every 24 hours for disaster recovery.</span></span> <span data-ttu-id="4a150-276">この機能を無効にすることはお勧めしません。</span><span class="sxs-lookup"><span data-stu-id="4a150-276">It is not recommended to turn this feature off.</span></span> <span data-ttu-id="4a150-277">詳細については、「[geo バックアップ](/azure/sql-data-warehouse/backup-and-restore#geo-backups)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-277">For more information, see [Geo-backups](/azure/sql-data-warehouse/backup-and-restore#geo-backups).</span></span>

## <a name="sql-server-running-in-a-vm"></a><span data-ttu-id="4a150-278">VM で実行されている SQL Server</span><span class="sxs-lookup"><span data-stu-id="4a150-278">SQL Server running in a VM</span></span>

<span data-ttu-id="4a150-279">**データベースをレプリケートします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-279">**Replicate the database.**</span></span> <span data-ttu-id="4a150-280">データベースをレプリケートするには、SQL Server Always On 可用性グループを使用します。</span><span class="sxs-lookup"><span data-stu-id="4a150-280">Use SQL Server Always On Availability Groups to replicate the database.</span></span> <span data-ttu-id="4a150-281">1 つの SQL Server インスタンスが失敗した場合は、高可用性を提供してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-281">Provides high availability if one SQL Server instance fails.</span></span> <span data-ttu-id="4a150-282">詳細については、「[n 層アプリケーションの Windows VM を実行する](../reference-architectures/virtual-machines-windows/n-tier.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-282">For more information, see [Run Windows VMs for an N-tier application](../reference-architectures/virtual-machines-windows/n-tier.md)</span></span>

<span data-ttu-id="4a150-283">**データベースをバックアップします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-283">**Back up the database**.</span></span> <span data-ttu-id="4a150-284">既に [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) を使用して VM をバックアップしている場合は、[DPM を使用した SQL Server ワークロード用 Azure Backup](/azure/backup/backup-azure-backup-sql/) を使用することを検討してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-284">If you are already using [Azure Backup](https://azure.microsoft.com/documentation/services/backup/) to back up your VMs, consider using [Azure Backup for SQL Server workloads using DPM](/azure/backup/backup-azure-backup-sql/).</span></span> <span data-ttu-id="4a150-285">このアプローチでは、組織用の 1 つのバックアップ管理者の役割と、VM および SQL Server 用の 1 つにまとめられた復旧手順があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-285">With this approach, there is one backup administrator role for the organization and a unified recovery procedure for VMs and SQL Server.</span></span> <span data-ttu-id="4a150-286">それ以外の場合は、[Microsoft Azure への SQL Server マネージド バックアップ](https://msdn.microsoft.com/library/dn449496.aspx)を使用してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-286">Otherwise, use [SQL Server Managed Backup to Microsoft Azure](https://msdn.microsoft.com/library/dn449496.aspx).</span></span>

## <a name="traffic-manager"></a><span data-ttu-id="4a150-287">Traffic Manager</span><span class="sxs-lookup"><span data-stu-id="4a150-287">Traffic Manager</span></span>

<span data-ttu-id="4a150-288">**手動フェールバックを実行します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-288">**Perform manual failback.**</span></span> <span data-ttu-id="4a150-289">Traffic Manager のフェールオーバーの後は、自動的にフェールバックするのではなく、手動フェールバックを実行してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-289">After a Traffic Manager failover, perform manual failback, rather than automatically failing back.</span></span> <span data-ttu-id="4a150-290">フェールバックする前に、すべてのアプリケーション サブシステムが正常であることを確認してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-290">Before failing back, verify that all application subsystems are healthy.</span></span>  <span data-ttu-id="4a150-291">これを行わないと、データセンター間でアプリケーションが切り替わる状況が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-291">Otherwise, you can create a situation where the application flips back and forth between data centers.</span></span> <span data-ttu-id="4a150-292">詳細については、「[高可用性を得るために複数のリージョンで VM を実行する](../reference-architectures/virtual-machines-windows/multi-region-application.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-292">For more information, see [Run VMs in multiple regions for high availability](../reference-architectures/virtual-machines-windows/multi-region-application.md).</span></span>

<span data-ttu-id="4a150-293">**正常性プローブのエンドポイントを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-293">**Create a health probe endpoint.**</span></span> <span data-ttu-id="4a150-294">アプリケーションの全体的な正常性についてレポートするカスタム エンドポイントを作成してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-294">Create a custom endpoint that reports on the overall health of the application.</span></span> <span data-ttu-id="4a150-295">これにより、クリティカル パスが失敗した場合に、フロント エンドだけでなく Traffic Manager をフェールオーバーできます。</span><span class="sxs-lookup"><span data-stu-id="4a150-295">This enables Traffic Manager to fail over if any critical path fails, not just the front end.</span></span> <span data-ttu-id="4a150-296">エンドポイントは、重要な依存関係が正常でない場合、または到達できない場合に、HTTP エラー コードを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-296">The endpoint should return an HTTP error code if any critical dependency is unhealthy or unreachable.</span></span> <span data-ttu-id="4a150-297">ただし、重要でないサービスについてはレポートしないでください。</span><span class="sxs-lookup"><span data-stu-id="4a150-297">Don't report errors for non-critical services, however.</span></span> <span data-ttu-id="4a150-298">そうしないと、必要のないときに正常性プローブがフェールオーバーをトリガーして、誤検知が生じる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-298">Otherwise, the health probe might trigger failover when it's not needed, creating false positives.</span></span> <span data-ttu-id="4a150-299">詳細については、「[Traffic Manager エンドポイントの監視とフェールオーバー](/azure/traffic-manager/traffic-manager-monitoring/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-299">For more information, see [Traffic Manager endpoint monitoring and failover](/azure/traffic-manager/traffic-manager-monitoring/).</span></span>

## <a name="virtual-machines"></a><span data-ttu-id="4a150-300">Virtual Machines</span><span class="sxs-lookup"><span data-stu-id="4a150-300">Virtual Machines</span></span>

<span data-ttu-id="4a150-301">**単一の VM で運用環境のワークロードを実行しないでください。**</span><span class="sxs-lookup"><span data-stu-id="4a150-301">**Avoid running a production workload on a single VM.**</span></span> <span data-ttu-id="4a150-302">単一の VM のデプロイには計画または計画外メンテナンスに対する回復力がありません。</span><span class="sxs-lookup"><span data-stu-id="4a150-302">A single VM deployment is not resilient to planned or unplanned maintenance.</span></span> <span data-ttu-id="4a150-303">代わりに、複数の VM を可用性セットまたは [VM スケール セット](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/)に配置し、前面にロード バランサーを配置してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-303">Instead, put multiple VMs in an availability set or [VM scale set](/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-overview/), with a load balancer in front.</span></span>

<span data-ttu-id="4a150-304">**VM をプロビジョニングするときに、可用性セットを指定します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-304">**Specify an availability set when you provision the VM.**</span></span> <span data-ttu-id="4a150-305">現時点では、VM がプロビジョニングされた後に、VM を可用性セットに追加する方法はありません。</span><span class="sxs-lookup"><span data-stu-id="4a150-305">Currently, there is no way to add a VM to an availability set after the VM is provisioned.</span></span> <span data-ttu-id="4a150-306">既存の可用性セットに新しい VM を追加するときは、必ず VM 用の NIC を作成し、NIC をロード バランサーのバックエンド アドレス プールに追加してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-306">When you add a new VM to an existing availability set, make sure to create a NIC for the VM, and add the NIC to the back-end address pool on the load balancer.</span></span> <span data-ttu-id="4a150-307">そうしないと、ロード バランサーがその VM にネットワーク トラフィックをルーティングしなくなります。</span><span class="sxs-lookup"><span data-stu-id="4a150-307">Otherwise, the load balancer won't route network traffic to that VM.</span></span>

<span data-ttu-id="4a150-308">**各アプリケーション層を別々の可用性セットに配置します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-308">**Put each application tier into a separate Availability Set.**</span></span> <span data-ttu-id="4a150-309">N 層のアプリケーションでは、同じ可用性セットの別の層からは VM を配置しないでください。</span><span class="sxs-lookup"><span data-stu-id="4a150-309">In an N-tier application, don't put VMs from different tiers into the same availability set.</span></span> <span data-ttu-id="4a150-310">可用性セット内の VM は、障害ドメイン (FD) と更新ドメイン (UD) にまたがって配置されています。</span><span class="sxs-lookup"><span data-stu-id="4a150-310">VMs in an availability set are placed across fault domains (FDs) and update domains (UD).</span></span> <span data-ttu-id="4a150-311">ただし、FD と UD の冗長性の利点を活用するには、可用性セットのすべての VM が同じクライアント要求を処理できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-311">However, to get the redundancy benefit of FDs and UDs, every VM in the availability set must be able to handle the same client requests.</span></span>

<span data-ttu-id="4a150-312">**パフォーマンスの要件に基づいて適切な VM サイズを選択します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-312">**Choose the right VM size based on performance requirements.**</span></span> <span data-ttu-id="4a150-313">既存のワークロードを Azure に移動する場合は、オンプレミスのサーバーに最も適合性が高い VM サイズから開始します。</span><span class="sxs-lookup"><span data-stu-id="4a150-313">When moving an existing workload to Azure, start with the VM size that's the closest match to your on-premises servers.</span></span> <span data-ttu-id="4a150-314">次に、CPU、メモリ、およびディスクの IOPS について、実際のワークロードのパフォーマンスを測定し、必要に応じてサイズを調整します。</span><span class="sxs-lookup"><span data-stu-id="4a150-314">Then measure the performance of your actual workload with respect to CPU, memory, and disk IOPS, and adjust the size if needed.</span></span> <span data-ttu-id="4a150-315">これにより、アプリケーションがクラウド環境で期待どおりに動作することを確認できます。</span><span class="sxs-lookup"><span data-stu-id="4a150-315">This helps to ensure the application behaves as expected in a cloud environment.</span></span> <span data-ttu-id="4a150-316">また、複数の NIC が必要な場合は、各サイズの NIC の制限に注意してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-316">Also, if you need multiple NICs, be aware of the NIC limit for each size.</span></span>

<span data-ttu-id="4a150-317">**VHD 用の Managed Disks を使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-317">**Use Managed Disks for VHDs.**</span></span> <span data-ttu-id="4a150-318">[Managed Disks][managed-disks] では、ディスクが単一障害点にならないように相互に十分に分離されるため、可用性セットの VM の信頼性が向上します。</span><span class="sxs-lookup"><span data-stu-id="4a150-318">[Managed Disks][managed-disks] provide better reliability for VMs in an availability set, because the disks are sufficiently isolated from each other to avoid single points of failure.</span></span> <span data-ttu-id="4a150-319">また、Managed Disks はストレージ アカウントで作成した VHD の IOPS 制限の対象ではありません。</span><span class="sxs-lookup"><span data-stu-id="4a150-319">Also, Managed Disks aren't subject to the IOPS limits of VHDs created in a storage account.</span></span> <span data-ttu-id="4a150-320">詳細については、「[Azure での Windows 仮想マシンの可用性の管理][vm-manage-availability]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-320">For more information, see [Manage the availability of Windows virtual machines in Azure][vm-manage-availability].</span></span>

<span data-ttu-id="4a150-321">**OS ディスクではなく、データ ディスクにアプリケーションをインストールします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-321">**Install applications on a data disk, not the OS disk.**</span></span> <span data-ttu-id="4a150-322">そうしないと、ディスク サイズの上限に達する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="4a150-322">Otherwise, you may reach the disk size limit.</span></span>

<span data-ttu-id="4a150-323">**Azure Backup を使用して VM をバックアップします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-323">**Use Azure Backup to back up VMs.**</span></span> <span data-ttu-id="4a150-324">バックアップにより偶発的なデータ損失から保護されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-324">Backups protect against accidental data loss.</span></span> <span data-ttu-id="4a150-325">詳細については、「[Recovery Services コンテナーを使用した Azure VM の保護](/azure/backup/backup-azure-vms-first-look-arm/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-325">For more information, see [Protect Azure VMs with a recovery services vault](/azure/backup/backup-azure-vms-first-look-arm/).</span></span>

<span data-ttu-id="4a150-326">基本的な正常性メトリック、インフラストラクチャ ログ、および[ブート診断][boot-diagnostics]などの**診断ログ**を有効にします。</span><span class="sxs-lookup"><span data-stu-id="4a150-326">**Enable diagnostic logs**, including basic health metrics, infrastructure logs, and [boot diagnostics][boot-diagnostics].</span></span> <span data-ttu-id="4a150-327">VM が起動不可能な状態になった場合は、起動エラーを診断するのにブート診断が役立ちます。</span><span class="sxs-lookup"><span data-stu-id="4a150-327">Boot diagnostics can help you diagnose a boot failure if your VM gets into a non-bootable state.</span></span> <span data-ttu-id="4a150-328">詳細については、「[Azure 診断ログの概要][diagnostics-logs]」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-328">For more information, see [Overview of Azure Diagnostic Logs][diagnostics-logs].</span></span>

<span data-ttu-id="4a150-329">**AzureLogCollector 拡張機能を使用します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-329">**Use the AzureLogCollector extension.**</span></span> <span data-ttu-id="4a150-330">(Windows VM のみ)この拡張機能は、オペレーターがリモートで VM にログを記録しなくても、Azure プラットフォームのログを集計し、それを Azure ストレージにアップロードします。</span><span class="sxs-lookup"><span data-stu-id="4a150-330">(Windows VMs only.) This extension aggregates Azure platform logs and uploads them to Azure storage, without the operator remotely logging into the VM.</span></span> <span data-ttu-id="4a150-331">詳細については、「[AzureLogCollector 拡張機能](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-331">For more information, see [AzureLogCollector Extension](/azure/virtual-machines/virtual-machines-windows-log-collector-extension/?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json).</span></span>

## <a name="virtual-network"></a><span data-ttu-id="4a150-332">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="4a150-332">Virtual Network</span></span>

<span data-ttu-id="4a150-333">**パブリック IP アドレスをホワイトリストに登録したりブロックしたりするには、サブネットに NSG を追加します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-333">**To whitelist or block public IP addresses, add an NSG to the subnet.**</span></span> <span data-ttu-id="4a150-334">悪意のあるユーザーからのアクセスをブロックしたり、アプリケーションにアクセスする権限を持つユーザーからのアクセスのみを許可したりしてください。</span><span class="sxs-lookup"><span data-stu-id="4a150-334">Block access from malicious users, or allow access only from users who have privilege to access the application.</span></span>  

<span data-ttu-id="4a150-335">**カスタムの正常性プローブを作成します。**</span><span class="sxs-lookup"><span data-stu-id="4a150-335">**Create a custom health probe.**</span></span> <span data-ttu-id="4a150-336">ロード バランサー正常性プローブでは、HTTP または TCP のいずれかをテストできます。</span><span class="sxs-lookup"><span data-stu-id="4a150-336">Load Balancer Health Probes can test either HTTP or TCP.</span></span> <span data-ttu-id="4a150-337">VM が HTTP サーバーを実行している場合、HTTP プローブは TCP プローブよりも優れた正常性状態のインジケーターです。</span><span class="sxs-lookup"><span data-stu-id="4a150-337">If a VM runs an HTTP server, the HTTP probe is a better indicator of health status than a TCP probe.</span></span> <span data-ttu-id="4a150-338">HTTP プローブでは、すべての重要な依存関係を含む、アプリケーションの全体的な正常性をレポートするカスタム エンドポイントを使用してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-338">For an HTTP probe, use a custom endpoint that reports the overall health of the application, including all critical dependencies.</span></span> <span data-ttu-id="4a150-339">詳細については、「[Azure Load Balancer の概要](/azure/load-balancer/load-balancer-overview/)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="4a150-339">For more information, see [Azure Load Balancer overview](/azure/load-balancer/load-balancer-overview/).</span></span>

<span data-ttu-id="4a150-340">**正常性プローブをブロックしないでください。**</span><span class="sxs-lookup"><span data-stu-id="4a150-340">**Don't block the health probe.**</span></span> <span data-ttu-id="4a150-341">ロード バランサー正常性プローブは、既知の IP アドレスである 168.63.129.16 から送信されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-341">The Load Balancer Health probe is sent from a known IP address, 168.63.129.16.</span></span> <span data-ttu-id="4a150-342">任意のファイアウォール ポリシーまたはネットワーク セキュリティ グループ (NSG) の規則で、この IP を送受信するトラフィックをブロックしないでください。</span><span class="sxs-lookup"><span data-stu-id="4a150-342">Don't block traffic to or from this IP in any firewall policies or network security group (NSG) rules.</span></span> <span data-ttu-id="4a150-343">正常性プローブをブロックすると、ロード バランサーによってローテーションから VM が削除されることがあります。</span><span class="sxs-lookup"><span data-stu-id="4a150-343">Blocking the health probe would cause the load balancer to remove the VM from rotation.</span></span>

<span data-ttu-id="4a150-344">**ロード バランサーのログ記録を有効にします。**</span><span class="sxs-lookup"><span data-stu-id="4a150-344">**Enable Load Balancer logging.**</span></span> <span data-ttu-id="4a150-345">ログには、プローブの応答に失敗したことが原因で、ネットワーク トラフィックを受信していない、バックエンドの VM 数が表示されます。</span><span class="sxs-lookup"><span data-stu-id="4a150-345">The logs show how many VMs on the back-end are not receiving network traffic due to failed probe responses.</span></span> <span data-ttu-id="4a150-346">詳細については、「[Azure Load Balancer のログ分析](/azure/load-balancer/load-balancer-monitor-log/)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="4a150-346">For more information, see [Log analytics for Azure Load Balancer](/azure/load-balancer/load-balancer-monitor-log/).</span></span>

<!-- links -->
[boot-diagnostics]: https://azure.microsoft.com/blog/boot-diagnostics-for-virtual-machines-v2/
[diagnostics-logs]: /azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs/
[managed-disks]: /azure/storage/storage-managed-disks-overview
[search-optimization]: /azure/search/search-performance-optimization/
[sql-backup]: /azure/sql-database/sql-database-automated-backups/
[sql-restore]: /azure/sql-database/sql-database-recovery-using-backups/
[vm-manage-availability]: /azure/virtual-machines/windows/manage-availability#use-managed-disks-for-vms-in-an-availability-set
