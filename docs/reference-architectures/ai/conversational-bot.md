---
title: エンタープライズ グレードの会話型ボットの作成
description: Azure Bot Framework を使用してエンタープライズ グレードの会話型ボット (チャットボット) を作成する方法。
author: roalexan
ms.date: 01/24/2019
ms.topic: reference-architecture
ms.service: architecture-center
ms.subservice: reference-architecture
ms.custom: azcat-ai
ms.openlocfilehash: 0f5de0eca6fbd35cca1a0e8443f363df09ffc6aa
ms.sourcegitcommit: 287344b6c220bdbd8076aed7a281eb02253e15be
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2019
ms.locfileid: "55712152"
---
# <a name="enterprise-grade-conversational-bot"></a><span data-ttu-id="e6176-103">エンタープライズ グレードの会話型ボット</span><span class="sxs-lookup"><span data-stu-id="e6176-103">Enterprise-grade conversational bot</span></span>

<span data-ttu-id="e6176-104">この参照アーキテクチャでは、[Azure Bot Framework][bot-framework] を使用してエンタープライズ グレードの会話型ボット (チャットボット) を作成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="e6176-104">This reference architecture describes how to build an enterprise-grade conversational bot (chatbot) using the [Azure Bot Framework][bot-framework].</span></span> <span data-ttu-id="e6176-105">ボットは 1 つずつ異なりますが、注意が必要な共通のパターンやワークフロー、テクノロジがいくつかあります。</span><span class="sxs-lookup"><span data-stu-id="e6176-105">Each bot is different, but there are some common patterns, workflows, and technologies to be aware of.</span></span> <span data-ttu-id="e6176-106">特に、エンタープライズ ワークロードを処理するボットの場合、コア機能以外にもさまざまな設計上の考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-106">Especially for a bot to serve enterprise workloads, there are many design considerations beyond just the core functionality.</span></span> <span data-ttu-id="e6176-107">この記事では、最も重要な設計上の側面について説明するとともに、積極的に学習を行う、堅牢で安全なボットの作成に必要なツールも紹介します。</span><span class="sxs-lookup"><span data-stu-id="e6176-107">This article covers the most essential design aspects, and introduces the tools needed to build a robust, secure, and actively learning bot.</span></span>

<span data-ttu-id="e6176-108">[![アーキテクチャの図][0]][0]</span><span class="sxs-lookup"><span data-stu-id="e6176-108">[![Diagram of the architecture][0]][0]</span></span>

<span data-ttu-id="e6176-109">このアーキテクチャで使用されるベスト プラクティスのユーティリティ サンプルは、完全にオープン ソースで提供されており、[GitHub][git-repo-base] で入手できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-109">The best practice utility samples used in this architecture are fully open-sourced and available on [GitHub][git-repo-base].</span></span> 

## <a name="architecture"></a><span data-ttu-id="e6176-110">アーキテクチャ</span><span class="sxs-lookup"><span data-stu-id="e6176-110">Architecture</span></span>

<span data-ttu-id="e6176-111">ここに示すアーキテクチャでは、次の Azure サービスを使用します。</span><span class="sxs-lookup"><span data-stu-id="e6176-111">The architecture shown here uses the following Azure services.</span></span> <span data-ttu-id="e6176-112">使用する独自のボットでは、これらのサービスの一部のみが使用されることも、他のサービスが組み込まれることもあります。</span><span class="sxs-lookup"><span data-stu-id="e6176-112">Your own bot may not use all of these services, or may incorporate additional services.</span></span>

### <a name="bot-logic-and-user-experience"></a><span data-ttu-id="e6176-113">ボット ロジックとユーザー エクスペリエンス</span><span class="sxs-lookup"><span data-stu-id="e6176-113">Bot logic and user experience</span></span>

- <span data-ttu-id="e6176-114">**[Bot Framework Service][bot-framework-service]** (BFS)。</span><span class="sxs-lookup"><span data-stu-id="e6176-114">**[Bot Framework Service][bot-framework-service]** (BFS).</span></span> <span data-ttu-id="e6176-115">このサービスは、ご使用のボットを Cortana、Facebook Messenger、Slack などの通信アプリに接続します。</span><span class="sxs-lookup"><span data-stu-id="e6176-115">This service connects your bot to a communication app such as Cortana, Facebook Messenger, or Slack.</span></span> <span data-ttu-id="e6176-116">ボットとユーザーの間の通信が円滑化されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-116">It facilitates communication between your bot and the user.</span></span>
- <span data-ttu-id="e6176-117">**[Azure App Service][app-service]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-117">**[Azure App Service][app-service]**.</span></span> <span data-ttu-id="e6176-118">ボットのアプリケーション ロジックは、Azure App Service でホストされます。</span><span class="sxs-lookup"><span data-stu-id="e6176-118">The bot application logic is hosted in Azure App Service.</span></span>

### <a name="bot-cognition-and-intelligence"></a><span data-ttu-id="e6176-119">ボットの認識力とインテリジェンス</span><span class="sxs-lookup"><span data-stu-id="e6176-119">Bot cognition and intelligence</span></span>

- <span data-ttu-id="e6176-120">**[Language Understanding][luis]** (LUIS)。</span><span class="sxs-lookup"><span data-stu-id="e6176-120">**[Language Understanding][luis]** (LUIS).</span></span> <span data-ttu-id="e6176-121">[Azure Cognitive Services][cognitive-services] の一部である LUIS によって、ユーザーの意図とエンティティが判別されることで、お客様のボットが自然言語を理解できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e6176-121">Part of [Azure Cognitive Services][cognitive-services], LUIS enables your bot to understand natural language by identifying user intents and entities.</span></span>
- <span data-ttu-id="e6176-122">**[Azure Search][search]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-122">**[Azure Search][search]**.</span></span> <span data-ttu-id="e6176-123">Search は、すばやい検索が可能なドキュメント インデックスを提供するマネージド サービスです。</span><span class="sxs-lookup"><span data-stu-id="e6176-123">Search is a managed service that provides a quick searchable document index.</span></span>
- <span data-ttu-id="e6176-124">**[QnA Maker][qna-maker]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-124">**[QnA Maker][qna-maker]**.</span></span> <span data-ttu-id="e6176-125">QnA Maker は、データに基づく対話型の Q&A レイヤーを作成できるクラウドベースの API サービスです。</span><span class="sxs-lookup"><span data-stu-id="e6176-125">QnA Maker is a cloud-based API service that creates a conversational, question-and-answer layer over your data.</span></span> <span data-ttu-id="e6176-126">通常、FAQ などの半構造化コンテンツが読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="e6176-126">Typically, it's loaded with semi-structured content such as FAQs.</span></span> <span data-ttu-id="e6176-127">これを使用して、自然言語の質問に回答するためのナレッジ ベースを作成します。</span><span class="sxs-lookup"><span data-stu-id="e6176-127">Use it to create a knowledge base for answering natural-language questions.</span></span>
- <span data-ttu-id="e6176-128">**[Web アプリ][webapp]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-128">**[Web app][webapp]**.</span></span> <span data-ttu-id="e6176-129">既存のサービスによって提供されない AI ソリューションがお客様のボットに必要な場合は、独自のカスタム AI を実装し、これを Web アプリとしてホストすることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-129">If your bot needs AI solutions not provided by an existing service, you can implement your own custom AI and host it as a web app.</span></span> <span data-ttu-id="e6176-130">これにより、ご使用のボットから呼び出される Web エンドポイントが提供されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-130">This provides a web endpoint for your bot to call.</span></span>

### <a name="data-ingestion"></a><span data-ttu-id="e6176-131">データの取り込み</span><span class="sxs-lookup"><span data-stu-id="e6176-131">Data ingestion</span></span>

<span data-ttu-id="e6176-132">ボットが使用する生データを取り込んで準備する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-132">The bot will rely on raw data that must be ingested and prepared.</span></span> <span data-ttu-id="e6176-133">このプロセスを調整するには、次のいずれかの方法を検討してください。</span><span class="sxs-lookup"><span data-stu-id="e6176-133">Consider any of the following options to orchestrate this process:</span></span>

- <span data-ttu-id="e6176-134">**[Azure Data Factory][data-factory]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-134">**[Azure Data Factory][data-factory]**.</span></span> <span data-ttu-id="e6176-135">Data Factory は、データ移動とデータ変換を調整し、自動化します。</span><span class="sxs-lookup"><span data-stu-id="e6176-135">Data Factory orchestrates and automates data movement and data transformation.</span></span>
- <span data-ttu-id="e6176-136">**[Logic Apps][logic-apps]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-136">**[Logic Apps][logic-apps]**.</span></span> <span data-ttu-id="e6176-137">Logic Apps は、アプリケーション、データ、およびサービスを統合するワークフローを構築するためのサーバーレス プラットフォームです。</span><span class="sxs-lookup"><span data-stu-id="e6176-137">Logic Apps is a serverless platform for building workflows that integrate applications, data, and services.</span></span> <span data-ttu-id="e6176-138">Logic Apps では、Office 365 など、多くのアプリケーションにデータ コネクタを提供します。</span><span class="sxs-lookup"><span data-stu-id="e6176-138">Logic Apps provides data connectors for many applications, including Office 365.</span></span>
- <span data-ttu-id="e6176-139">**[Azure Functions][functions]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-139">**[Azure Functions][functions]**.</span></span> <span data-ttu-id="e6176-140">Azure Functions を使用すると、[トリガー][functions-triggers]&mdash;によって (たとえば、ドキュメントが Blob Storage や Cosmos DB に追加されるたびに) 呼び出されるカスタム サーバーレス コードを記述できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-140">You can use Azure Functions to write custom serverless code that is invoked by a [trigger][functions-triggers] &mdash; for example, whenever a document is added to blob storage or Cosmos DB.</span></span>

### <a name="logging-and-monitoring"></a><span data-ttu-id="e6176-141">ログ記録と監視</span><span class="sxs-lookup"><span data-stu-id="e6176-141">Logging and monitoring</span></span>

- <span data-ttu-id="e6176-142">**[Application Insights][app-insights]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-142">**[Application Insights][app-insights]**.</span></span> <span data-ttu-id="e6176-143">監視、診断、分析の目的でボットのアプリケーション メトリックをログに記録するには、Application Insights を使用します。</span><span class="sxs-lookup"><span data-stu-id="e6176-143">Use Application Insights to log the bot's application metrics for monitoring, diagnostic, and analytical purposes.</span></span>
- <span data-ttu-id="e6176-144">**[Azure Blob Storage][blob]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-144">**[Azure Blob Storage][blob]**.</span></span> <span data-ttu-id="e6176-145">Blob Storage は、テキスト データやバイナリ データなどの大量の非構造化データを格納するために最適化されています。</span><span class="sxs-lookup"><span data-stu-id="e6176-145">Blob storage is optimized for storing massive amounts of unstructured data.</span></span>
- <span data-ttu-id="e6176-146">**[Cosmos DB][cosmosdb]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-146">**[Cosmos DB][cosmosdb]**.</span></span> <span data-ttu-id="e6176-147">Cosmos DB は、会話など、半構造化ログ データの格納に適しています。</span><span class="sxs-lookup"><span data-stu-id="e6176-147">Cosmos DB is well-suited for storing semi-structured log data such as conversations.</span></span>
- <span data-ttu-id="e6176-148">**[Power BI][power-bi]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-148">**[Power BI][power-bi]**.</span></span> <span data-ttu-id="e6176-149">お使いのボットの監視ダッシュボードを作成するには、Power BI を使用します。</span><span class="sxs-lookup"><span data-stu-id="e6176-149">Use Power BI to create monitoring dashboards for your bot.</span></span>

### <a name="security-and-governance"></a><span data-ttu-id="e6176-150">セキュリティとガバナンス</span><span class="sxs-lookup"><span data-stu-id="e6176-150">Security and governance</span></span>

- <span data-ttu-id="e6176-151">**[Azure Active Directory][aad]** (Azure AD)。</span><span class="sxs-lookup"><span data-stu-id="e6176-151">**[Azure Active Directory][aad]** (Azure AD).</span></span> <span data-ttu-id="e6176-152">ユーザーは、Azure AD などの ID プロバイダーを通じて認証されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-152">Users will authenticate through an identity provider such as Azure AD.</span></span> <span data-ttu-id="e6176-153">Bot Service では、認証フローと OAuth トークンの管理を処理します。</span><span class="sxs-lookup"><span data-stu-id="e6176-153">The Bot Service handles the authentication flow and OAuth token management.</span></span> <span data-ttu-id="e6176-154">「[Azure Bot Service を介してボットに認証を追加する][bot-authentication]」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e6176-154">See [Add authentication to your bot via Azure Bot Service][bot-authentication].</span></span>
- <span data-ttu-id="e6176-155">**[Azure Key Vault][key-vault]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-155">**[Azure Key Vault][key-vault]**.</span></span> <span data-ttu-id="e6176-156">Key Vault を使用して資格情報やその他のシークレットを格納します。</span><span class="sxs-lookup"><span data-stu-id="e6176-156">Store credentials and other secrets using Key Vault.</span></span>

### <a name="quality-assurance-and-enhancements"></a><span data-ttu-id="e6176-157">品質保証と拡張機能</span><span class="sxs-lookup"><span data-stu-id="e6176-157">Quality assurance and enhancements</span></span>

- <span data-ttu-id="e6176-158">**[Azure DevOps][devops]**。</span><span class="sxs-lookup"><span data-stu-id="e6176-158">**[Azure DevOps][devops]**.</span></span> <span data-ttu-id="e6176-159">ソース管理、ビルド、テスト、デプロイ、プロジェクト追跡など、アプリ管理のための各種サービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="e6176-159">Provides many services for app management, including source control, building, testing, deployment, and project tracking.</span></span>
- <span data-ttu-id="e6176-160">**[VS Code][vscode]**。アプリ開発用の軽量なコード エディター。</span><span class="sxs-lookup"><span data-stu-id="e6176-160">**[VS Code][vscode]** A lightweight code editor for app development.</span></span> <span data-ttu-id="e6176-161">同様の機能を備えたその他の任意の IDE を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-161">You can use any other IDE with similar features.</span></span>

## <a name="design-considerations"></a><span data-ttu-id="e6176-162">設計上の考慮事項</span><span class="sxs-lookup"><span data-stu-id="e6176-162">Design considerations</span></span>

<span data-ttu-id="e6176-163">大まかに言うと、会話ボットは、ボット機能 ("脳") と一連の周辺的要件 ("身体") に分けることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-163">At a high level, a conversational bot can be divided into the bot functionality (the "brain") and a set of surrounding requirements (the "body").</span></span> <span data-ttu-id="e6176-164">脳には、ボット ロジックや ML 機能など、知識領域に対応したコンポーネントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e6176-164">The brain includes the domain-aware components, including the bot logic and ML capabilities.</span></span> <span data-ttu-id="e6176-165">その他のコンポーネントは知識領域に関係がなく、CI/CD、品質保証、セキュリティなどの非機能的要件に対処します。</span><span class="sxs-lookup"><span data-stu-id="e6176-165">Other components are domain agnostic and address non-functional requirements such as CI/CD, quality assurance, and security.</span></span>

![ボット機能の論理図](./_images/conversational-bot-logical.png)

<span data-ttu-id="e6176-167">このアーキテクチャの詳細に入る前に、設計の各サブコンポーネントを通過するデータ フローを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="e6176-167">Before getting into the specifics of this architecture, let's start with the data flow through each subcomponent of the design.</span></span> <span data-ttu-id="e6176-168">データ フローには、ユーザーが開始するデータ フローと、システムによって開始されるデータ フローがあります。</span><span class="sxs-lookup"><span data-stu-id="e6176-168">The data flow includes user-initiated and system-initiated data flows.</span></span>

### <a name="user-message-flow"></a><span data-ttu-id="e6176-169">ユーザー メッセージ フロー</span><span class="sxs-lookup"><span data-stu-id="e6176-169">User message flow</span></span>

<span data-ttu-id="e6176-170">**[認証]**: </span><span class="sxs-lookup"><span data-stu-id="e6176-170">**Authentication**.</span></span> <span data-ttu-id="e6176-171">ユーザーは、まず、ボットとの通信チャネルによって提供される任意のメカニズムを使用して、自分自身を認証します。</span><span class="sxs-lookup"><span data-stu-id="e6176-171">Users start by authenticating themselves using whatever mechanism is provided by their channel of communication with the bot.</span></span> <span data-ttu-id="e6176-172">Bot Framework では、Cortana、Microsoft Teams、Facebook Messenger、Kik、Slack など、多くの通信チャネルがサポートされています。</span><span class="sxs-lookup"><span data-stu-id="e6176-172">The bot framework supports many communication channels, including Cortana, Microsoft Teams, Facebook Messenger, Kik, and Slack.</span></span> <span data-ttu-id="e6176-173">チャネルの一覧については、「[ボットをチャネルに接続する](/azure/bot-service/bot-service-manage-channels)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e6176-173">For a list of channels, see [Connect a bot to channels](/azure/bot-service/bot-service-manage-channels).</span></span> <span data-ttu-id="e6176-174">Azure Bot Service を使用してボットを作成すると、[Web チャット][webchat] チャンネルが自動的に構成されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-174">When you create a bot with Azure Bot Service, the [Web Chat][webchat] channel is automatically configured.</span></span> <span data-ttu-id="e6176-175">ユーザーはこのチャネルを使用することで、Web ページから直接ボットとやり取りすることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-175">This channel allows users to interact with your bot directly in a web page.</span></span> <span data-ttu-id="e6176-176">また、[Direct Line](/azure/bot-service/bot-service-channel-connect-directline) チャネルを使用して、ボットをカスタム アプリに接続することもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-176">You can also connect the bot to a custom app by using the [Direct Line](/azure/bot-service/bot-service-channel-connect-directline) channel.</span></span> <span data-ttu-id="e6176-177">ユーザーの ID は、ロールベースのアクセス制御や、パーソナライズされたコンテンツを提供するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-177">The user's identity is used to provide role-based access control, as well as to serve personalized content.</span></span>

<span data-ttu-id="e6176-178">**ユーザー メッセージ**。</span><span class="sxs-lookup"><span data-stu-id="e6176-178">**User message**.</span></span> <span data-ttu-id="e6176-179">認証されると、ユーザーはボットにメッセージを送信します。</span><span class="sxs-lookup"><span data-stu-id="e6176-179">Once authenticated, the user sends a message to the bot.</span></span> <span data-ttu-id="e6176-180">ボットはこのメッセージを読み取って、[LUIS](/azure/cognitive-services/luis/) などの自然言語理解サービスにルーティングします。</span><span class="sxs-lookup"><span data-stu-id="e6176-180">The bot reads the message and routes it to a natural language understanding service such as [LUIS](/azure/cognitive-services/luis/).</span></span> <span data-ttu-id="e6176-181">この段階で、**意図** (ユーザーがしたいこと) と**エンティティ** (ユーザーの関心の対象) が取得されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-181">This step gets the **intents** (what the user wants to do) and **entities** (what things the user is interested in).</span></span> <span data-ttu-id="e6176-182">次にボットは、文書検索用の [Azure Search][search]、FAQ 用の [QnA Maker](https://www.qnamaker.ai/)、カスタム ナレッジ ベースなど、情報を提供するサービスに渡すクエリを作成します。</span><span class="sxs-lookup"><span data-stu-id="e6176-182">The bot then builds a query that it passes to a service that serves information, such as [Azure Search][search] for document retrieval, [QnA Maker](https://www.qnamaker.ai/) for FAQs, or a custom knowledge base.</span></span> <span data-ttu-id="e6176-183">ボットは、これらの結果を使用して応答を作成します。</span><span class="sxs-lookup"><span data-stu-id="e6176-183">The bot uses these results to construct a response.</span></span> <span data-ttu-id="e6176-184">特定のクエリから最適な結果が得られるように、ボットはこれらのリモート サービスとのやり取りを複数回繰り返す場合があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-184">To give the best result for a  given query, the bot might make several back-and-forth calls to these remote services.</span></span>

<span data-ttu-id="e6176-185">**応答**。</span><span class="sxs-lookup"><span data-stu-id="e6176-185">**Response**.</span></span> <span data-ttu-id="e6176-186">この時点で、ボットは最適な応答を決定し、これをユーザーに送信します。</span><span class="sxs-lookup"><span data-stu-id="e6176-186">At this point, the bot has determined the best response and sends it to the user.</span></span> <span data-ttu-id="e6176-187">最も適合した回答の信頼度スコアが低い場合、応答は、あいまいさを排除するための質問になったり、ボットが的確に応答できないことの確認になったりする可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-187">If the confidence score of the best-matched answer is low, the response might be a disambiguation question or an acknowledgement that the bot could not reply adequately.</span></span>

<span data-ttu-id="e6176-188">**ログの記録**。</span><span class="sxs-lookup"><span data-stu-id="e6176-188">**Logging**.</span></span> <span data-ttu-id="e6176-189">ユーザーの要求が受信されたり、応答が送信されたりしたとき、すべての会話アクションは、パフォーマンス メトリックや外部サービスの一般的なエラーと共に、ログ ストアに記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-189">When a user request is received or a response is sent, all conversation actions should be logged to a logging store, along with performance metrics and general errors from external services.</span></span> <span data-ttu-id="e6176-190">これらのログは、後で問題を診断したり、システムを改善したりする際に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e6176-190">These logs will be useful later when diagnosing issues and improving the system.</span></span>

<span data-ttu-id="e6176-191">**フィードバック**。</span><span class="sxs-lookup"><span data-stu-id="e6176-191">**Feedback**.</span></span> <span data-ttu-id="e6176-192">また、ユーザー フィードバックや満足度のスコアを収集することもお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-192">Another good practice is to collect user feedback and satisfaction scores.</span></span> <span data-ttu-id="e6176-193">ボットの最終応答のフォロー アップとして、応答に対する満足度を評価してもらうようボットからユーザーに依頼します。</span><span class="sxs-lookup"><span data-stu-id="e6176-193">As a follow up to the bot's final response, the bot should ask the user to rate their satisfaction with the reply.</span></span> <span data-ttu-id="e6176-194">フィードバックは、自然言語の理解に関するコールド スタートの問題を解決したり、応答の精度を継続的に改善したりするうえで役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e6176-194">Feedback can help you to solve the cold start problem of natural language understanding, and continually improve the accuracy of responses.</span></span>

### <a name="system-data-flow"></a><span data-ttu-id="e6176-195">システムのデータ フロー</span><span class="sxs-lookup"><span data-stu-id="e6176-195">System Data Flow</span></span>

<span data-ttu-id="e6176-196">**ETL**。</span><span class="sxs-lookup"><span data-stu-id="e6176-196">**ETL**.</span></span> <span data-ttu-id="e6176-197">ボットは、バックエンドの ETL プロセスによって生データから抽出される情報と知識に依存しています。</span><span class="sxs-lookup"><span data-stu-id="e6176-197">The bot relies on information and knowledge extracted from the raw data by an ETL process in the backend.</span></span> <span data-ttu-id="e6176-198">このデータは、構造化データ (SQL データベース)、半構造化データ (CRM システム、FAQ)、または非構造化データ (Word 文書、PDF、Web ログ) である可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-198">This data might be structured (SQL database), semi-structured (CRM system, FAQs), or unstructured (Word documents, PDFs, web logs).</span></span> <span data-ttu-id="e6176-199">ETL サブシステムにより、決まったスケジュールでデータが抽出されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-199">An ETL subsystem extracts the data on a fixed schedule.</span></span> <span data-ttu-id="e6176-200">コンテンツが変換およびエンリッチされ、Cosmos DB や Azure Blob Storage などの中間データ ストアに読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="e6176-200">The content is transformed and enriched, then loaded into an intermediary data store, such as Cosmos DB or Azure Blob Storage.</span></span>

<span data-ttu-id="e6176-201">次に、中間ストア内のデータは、文書検索できるように Azure Search 内にインデックス化されたり、QnA Maker に読み込まれて質問と回答のペアが作成されたり、カスタム Web アプリに読み込まれて非構造化テキスト処理が行われたります。</span><span class="sxs-lookup"><span data-stu-id="e6176-201">Data in the intermediary store is then indexed into Azure Search for document retrieval, loaded into QnA Maker to create question and answer pairs, or loaded into a custom web app for unstructured text processing.</span></span> <span data-ttu-id="e6176-202">また、このデータは、意図とエンティティを抽出できるように、LUIS モデルのトレーニングにも使用されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-202">The data is also used to train a LUIS model for intent and entity extraction.</span></span>

<span data-ttu-id="e6176-203">**品質保証**。</span><span class="sxs-lookup"><span data-stu-id="e6176-203">**Quality assurance**.</span></span> <span data-ttu-id="e6176-204">会話のログは、バグの診断や修正、ボットの使用状況に関する分析情報の提供、および全体的なパフォーマンスの追跡に使用されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-204">The conversation logs are used to diagnose and fix bugs, provide insight into how the bot is being used, and track overall performance.</span></span> <span data-ttu-id="e6176-205">フィードバック データは、AI モデルを再トレーニングしてボットのパフォーマンスを向上させる際に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e6176-205">Feedback data is useful for retraining the AI models to improve bot performance.</span></span>

## <a name="building-a-bot"></a><span data-ttu-id="e6176-206">ボットの作成</span><span class="sxs-lookup"><span data-stu-id="e6176-206">Building a bot</span></span>

<span data-ttu-id="e6176-207">コードの 1 行目を記述する前に、開発チームがボットに期待される動作を明確に理解できるように、機能仕様を書くことが重要です。</span><span class="sxs-lookup"><span data-stu-id="e6176-207">Before you even write a single line of code, it's important to write a functional specification so the development team has a clear idea of what the bot is expected to do.</span></span> <span data-ttu-id="e6176-208">仕様には、さまざまな知識領域でのユーザー入力と予想されるボットの応答について、かなり包括的なリストを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-208">The specification should include a reasonably comprehensive list of user inputs and expected bot responses in various knowledge domains.</span></span> <span data-ttu-id="e6176-209">随時更新されるこのドキュメントは、ボットを開発およびテストするための非常に貴重なガイドとなります。</span><span class="sxs-lookup"><span data-stu-id="e6176-209">This living document will be an invaluable guide for developing and testing your bot.</span></span>

### <a name="ingest-data"></a><span data-ttu-id="e6176-210">データの取り込み</span><span class="sxs-lookup"><span data-stu-id="e6176-210">Ingest data</span></span>

<span data-ttu-id="e6176-211">次に、ボットがユーザーとインテリジェントにやり取りできるようにするデータ ソースを特定します。</span><span class="sxs-lookup"><span data-stu-id="e6176-211">Next, identify the data sources that will enable the bot to interact intelligently with users.</span></span> <span data-ttu-id="e6176-212">前述のように、これらのデータ ソースとしては、構造化データ セット、半構造化データ セット、または非構造化データ セットがあります。</span><span class="sxs-lookup"><span data-stu-id="e6176-212">As mentioned earlier, these data sources could contain structured, semi-structured, or unstructured data sets.</span></span> <span data-ttu-id="e6176-213">開始するにあたり、Cosmos DB や Azure Storage などの中央のストアにデータを 1 回だけコピーすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-213">When you're getting started, a good approach is to make a one-off copy of the data to a central store, such as Cosmos DB or Azure Storage.</span></span> <span data-ttu-id="e6176-214">進行に合わせて、自動化されたデータ インジェスト パイプラインを作成し、このデータを最新の状態に維持する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-214">As you progress, you should create an automated data ingestion pipeline to keep this data current.</span></span> <span data-ttu-id="e6176-215">自動化されたインジェスト パイプラインのオプションには、Data Factory、Functions、および Logic Apps があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-215">Options for an automated ingestion pipeline include Data Factory, Functions, and Logic Apps.</span></span> <span data-ttu-id="e6176-216">データ ストアとスキーマによっては、これらのアプローチを組み合わせて使用する場合もあります。</span><span class="sxs-lookup"><span data-stu-id="e6176-216">Depending on the data stores and the schemas, you might use a combination of these approaches.</span></span>

<span data-ttu-id="e6176-217">始める時点では、Azure portal を使用して手動で Azure リソースを作成するのが合理的です。</span><span class="sxs-lookup"><span data-stu-id="e6176-217">As you get started, it's reasonable to use the Azure portal to manually create Azure resources.</span></span> <span data-ttu-id="e6176-218">これらのリソースのデプロイの自動化については、後でさらに検討を重ねる必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-218">Later on, you should put more thought into automating the deployment of these resources.</span></span>

### <a name="core-bot-logic-and-ux"></a><span data-ttu-id="e6176-219">ボットのコア ロジックとユーザー エクスペリエンス</span><span class="sxs-lookup"><span data-stu-id="e6176-219">Core bot logic and UX</span></span>

<span data-ttu-id="e6176-220">仕様とデータが用意できたら、いよいよ実際にボットの作成を開始します。</span><span class="sxs-lookup"><span data-stu-id="e6176-220">Once you have a specification and some data, it's time to start making your bot into reality.</span></span> <span data-ttu-id="e6176-221">ボットのコア ロジックに注目しましょう。</span><span class="sxs-lookup"><span data-stu-id="e6176-221">Let's focus on the core bot logic.</span></span> <span data-ttu-id="e6176-222">ルーティング ロジック、あいまいさ排除ロジック、ログ記録など、ユーザーとの会話を処理するコードがこれに当たります。</span><span class="sxs-lookup"><span data-stu-id="e6176-222">This is the code that handles the conversation with the user, including the routing logic, disambiguation logic, and logging.</span></span> <span data-ttu-id="e6176-223">以下を含め、まず [Bot Framework][bot-framework] に慣れることから始めてください。</span><span class="sxs-lookup"><span data-stu-id="e6176-223">Start by familiarizing yourself with the [Bot Framework][bot-framework], including:</span></span>

- <span data-ttu-id="e6176-224">特に、[会話]、[ターン]、[アクティビティ]など、フレームワークで使用される基本的な概念と用語。</span><span class="sxs-lookup"><span data-stu-id="e6176-224">Basic concepts and terminology used in the framework, especially [conversations], [turns], and [activities].</span></span>
- <span data-ttu-id="e6176-225">ボットとチャネルの間のネットワークを処理する [Bot Connector サービス](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart)。</span><span class="sxs-lookup"><span data-stu-id="e6176-225">The [Bot Connector service](/azure/bot-service/rest-api/bot-framework-rest-connector-quickstart), which handles the networking between the bot and your channels.</span></span>
- <span data-ttu-id="e6176-226">メモリや、可能であればストア (Azure Blob Storage、Azure Cosmos DB など) で、会話[状態](/azure/bot-service/bot-builder-concept-state)を維持する方法。</span><span class="sxs-lookup"><span data-stu-id="e6176-226">How conversation [state](/azure/bot-service/bot-builder-concept-state) is maintained, either in memory or better yet in a store such as Azure Blob Storage or Azure Cosmos DB.</span></span>
- <span data-ttu-id="e6176-227">[ミドルウェア](/azure/bot-service/bot-builder-basics#middleware)。また、ミドルウェアを使用して、Cognitive Services などの外部サービスにボットをフックする方法。</span><span class="sxs-lookup"><span data-stu-id="e6176-227">[Middleware](/azure/bot-service/bot-builder-basics#middleware), and how it can be used to hook up your bot with external services, such as Cognitive Services.</span></span>

<span data-ttu-id="e6176-228">豊かな[ユーザー エクスペリエンス](/azure/bot-service/bot-service-design-user-experience)を実現するオプションは多数あります。</span><span class="sxs-lookup"><span data-stu-id="e6176-228">For a rich [user experience](/azure/bot-service/bot-service-design-user-experience), there are many options.</span></span>

- <span data-ttu-id="e6176-229">[カード](/azure/bot-service/bot-service-design-user-experience#cards)を使用して、ボタン、イメージ、カルーセル、およびメニューを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-229">You can use [cards](/azure/bot-service/bot-service-design-user-experience#cards) to include buttons, images, carousels, and menus.</span></span>
- <span data-ttu-id="e6176-230">ボットでは音声がサポートされます。</span><span class="sxs-lookup"><span data-stu-id="e6176-230">A bot can support speech.</span></span>
- <span data-ttu-id="e6176-231">ボットをアプリや Web サイトに埋め込むことで、ボットをホストするアプリの機能を使用することもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-231">You can even embed your bot in an app or website and use the capabilities of the app hosting it.</span></span>

<span data-ttu-id="e6176-232">最初に、[Azure Bot Service](/azure/bot-service/bot-service-quickstart) を使用してオンラインでボットを作成します。C# と Node.js から使用可能なテンプレートを選択します。</span><span class="sxs-lookup"><span data-stu-id="e6176-232">To get started, you can build your bot online using the [Azure Bot Service](/azure/bot-service/bot-service-quickstart), selecting from the available C# and Node.js templates.</span></span> <span data-ttu-id="e6176-233">ボットが洗練されてくるにつれて、ボットをローカルで作成して、それを Web にデプロイする必要が生じます。</span><span class="sxs-lookup"><span data-stu-id="e6176-233">As your bot gets more sophisticated, however, you will need to create your bot locally then deploy it to the web.</span></span> <span data-ttu-id="e6176-234">Visual Studio や Visual Studio Code などの IDE とプログラミング言語を選択します。</span><span class="sxs-lookup"><span data-stu-id="e6176-234">Choose an IDE, such as Visual Studio or Visual Studio Code, and a programming language.</span></span> <span data-ttu-id="e6176-235">次の言語では SDK を利用できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-235">SDKs are available for the following languages:</span></span>

- [<span data-ttu-id="e6176-236">C#</span><span class="sxs-lookup"><span data-stu-id="e6176-236">C#</span></span>](https://github.com/microsoft/botbuilder-dotnet)
- [<span data-ttu-id="e6176-237">JavaScript</span><span class="sxs-lookup"><span data-stu-id="e6176-237">JavaScript</span></span>](https://github.com/microsoft/botbuilder-js)
- <span data-ttu-id="e6176-238">[Java](https://github.com/microsoft/botbuilder-java) (プレビュー)</span><span class="sxs-lookup"><span data-stu-id="e6176-238">[Java](https://github.com/microsoft/botbuilder-java) (preview)</span></span>
- <span data-ttu-id="e6176-239">[Python](https://github.com/microsoft/botbuilder-python) (プレビュー)</span><span class="sxs-lookup"><span data-stu-id="e6176-239">[Python](https://github.com/microsoft/botbuilder-python) (preview)</span></span>

<span data-ttu-id="e6176-240">出発点として、Azure Bot Service を使用して作成するボット向けのソース コードをダウンロードできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-240">As a starting point, you can download the source code for the bot you created using the Azure Bot Service.</span></span> <span data-ttu-id="e6176-241">単純なエコー ボットから各種 AI サービスが統合された高度なボットまで、[サンプル コード](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md)を検索することもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-241">You can also find [sample code](https://github.com/Microsoft/BotBuilder-Samples/blob/master/README.md), from simple echo bots to more sophisticated bots that integrate with various AI services.</span></span>

### <a name="add-smarts-to-your-bot"></a><span data-ttu-id="e6176-242">ボットをよりスマートにする</span><span class="sxs-lookup"><span data-stu-id="e6176-242">Add smarts to your bot</span></span>

<span data-ttu-id="e6176-243">適切に定義されたコマンドの一覧を備えた単純なボットの場合、ルールベースのアプローチを使用して正規表現でユーザー入力を解析できる場合があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-243">For a simple bot with a well-defined list of commands, you might be able to use a rules-based approach to parse the user input via regex.</span></span> <span data-ttu-id="e6176-244">これには、確定的でわかりやすいという利点があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-244">This has the advantage of being deterministic and understandable.</span></span> <span data-ttu-id="e6176-245">ただし、ボットがより自然言語に近いメッセージの意図とエンティティを理解する必要がある場合は、AI サービスを役立てることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-245">However, when your bot needs to understand the intents and entities of a more natural-language message, there are AI services that can help.</span></span>

- <span data-ttu-id="e6176-246">LUIS は、特にユーザーの意図とエンティティを理解できるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="e6176-246">LUIS is specifically designed to understand user intents and entities.</span></span> <span data-ttu-id="e6176-247">関連性のある[ユーザー入力](/azure/cognitive-services/luis/luis-concept-utterance)と望ましい応答から成る適度な規模のコレクションを使用して LUIS をトレーニングすると、ユーザーの特定メッセージの意図とエンティティが返されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-247">You train it with a moderately sized collection of relevant [user input](/azure/cognitive-services/luis/luis-concept-utterance) and desired responses, and it returns the intents and entities for a user's given message.</span></span>

- <span data-ttu-id="e6176-248">Azure Search を LUIS と連携させることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-248">Azure Search can work alongside LUIS.</span></span> <span data-ttu-id="e6176-249">Search を使用して、すべての関連データに対して検索可能なインデックスを作成します。</span><span class="sxs-lookup"><span data-stu-id="e6176-249">Using Search, you create searchable indexes over all relevant data.</span></span> <span data-ttu-id="e6176-250">ボットがこれらのインデックスにクエリを実行して、LUIS によって抽出されたエンティティを取得します。</span><span class="sxs-lookup"><span data-stu-id="e6176-250">The bot queries these indexes for the entities extracted by LUIS.</span></span> <span data-ttu-id="e6176-251">Azure Search では、[シノニム][synonyms]もサポートされているため、正しい単語マッピングを捉えるための網を拡げることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-251">Azure Search also supports [synonyms][synonyms], which can widen the net of correct word mappings.</span></span>

- <span data-ttu-id="e6176-252">QnA Maker は、特定の質問に対して回答を返すように設計されているもう 1 つのサービスです。</span><span class="sxs-lookup"><span data-stu-id="e6176-252">QnA Maker is another service that is designed to return answers for given questions.</span></span> <span data-ttu-id="e6176-253">これは通常、FAQ などの半構造化データに対してトレーニングされます。</span><span class="sxs-lookup"><span data-stu-id="e6176-253">It's typically trained over semi-structured data such as FAQs.</span></span>

<span data-ttu-id="e6176-254">ボットは、その他の AI サービスを使用して、ユーザー エクスペリエンスをさらに強化することができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-254">Your bot can use other AI services to further enrich the user experience.</span></span> <span data-ttu-id="e6176-255">[事前構築済みの AI サービスから成る Cognitive Services スイート](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) (LUIS や QnA Maker を含む) には、視覚、音声、言語、検索、および場所に対応したサービスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e6176-255">The [Cognitive Services suite of pre-built AI](https://azure.microsoft.com/en-us/services/cognitive-services/?v=18.44a) services (which includes LUIS and QnA Maker) has services for vision, speech, language, search, and location.</span></span> <span data-ttu-id="e6176-256">言語翻訳、スペル チェック、センチメント分析、OCR、位置把握、コンテンツ モデレーションなどの機能を簡単に追加することができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-256">You can quickly add functionality such as language translation, spell checking, sentiment analysis, OCR, location awareness, and content moderation.</span></span> <span data-ttu-id="e6176-257">これらのサービスをミドルウェア モジュールとしてボットに設定することで、より自然かつインテリジェントにユーザーと対話できるようになります。</span><span class="sxs-lookup"><span data-stu-id="e6176-257">These services can be wired up as middleware modules in your bot to interact more naturally and intelligently with the user.</span></span>

<span data-ttu-id="e6176-258">別のオプションとして、独自のカスタム AI サービスを統合することもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-258">Another option is to integrate your own custom AI service.</span></span> <span data-ttu-id="e6176-259">この方法は複雑さが増しますが、機械学習アルゴリズム、トレーニング、およびモデルという点に関して完全な柔軟性が得られます。</span><span class="sxs-lookup"><span data-stu-id="e6176-259">This approach is more complex, but gives you complete flexibility in terms of the machine learning algorithm, training, and model.</span></span> <span data-ttu-id="e6176-260">たとえば、独自のトピック モデリングを実装し、[LDA][lda] などのアルゴリズムを使用して類似または関連する文書を検索できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-260">For example, you could implement your own topic modeling and use algorithm such as [LDA][lda] to find similar or relevant documents.</span></span> <span data-ttu-id="e6176-261">Web サービスのエンドポイントとしてカスタム AI ソリューションを公開し、ボットのコア ロジックからエンドポイントを呼び出すことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-261">A good approach is to expose your custom AI solution as a web service endpoint, and call the endpoint from the core bot logic.</span></span> <span data-ttu-id="e6176-262">Web サービスは、App Service または VM のクラスターでホストすることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-262">The web service could be hosted in App Service or in a cluster of VMs.</span></span> <span data-ttu-id="e6176-263">[Azure Machine Learning][aml] には、モデルの[トレーニング](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training)と[デプロイ](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment)を支援する多くのサービスとライブラリが用意されています。</span><span class="sxs-lookup"><span data-stu-id="e6176-263">[Azure Machine Learning][aml] provides a number of services and libraries to assist you in [training](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/training) and [deploying](https://github.com/Azure/MachineLearningNotebooks/tree/master/how-to-use-azureml/deployment) your models.</span></span>

## <a name="quality-assurance-and-enhancement"></a><span data-ttu-id="e6176-264">品質保証と拡張機能</span><span class="sxs-lookup"><span data-stu-id="e6176-264">Quality assurance and enhancement</span></span>

<span data-ttu-id="e6176-265">**ログの記録**。</span><span class="sxs-lookup"><span data-stu-id="e6176-265">**Logging**.</span></span> <span data-ttu-id="e6176-266">基になるパフォーマンス メトリックやすべてのエラーを含め、ユーザーとボットの会話が記録されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-266">Log user conversations with the bot, including the underlying performance metrics and any errors.</span></span> <span data-ttu-id="e6176-267">これらのログは、問題のデバッグ、ユーザー操作の理解、システムの改善を行う際に、非常に重要な役割を果たします。</span><span class="sxs-lookup"><span data-stu-id="e6176-267">These logs will prove invaluable for debugging issues, understanding user interactions, and improving the system.</span></span> <span data-ttu-id="e6176-268">ログの種類ごとに、適切なデータ ストアが異なる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-268">Different data stores might be appropriate for different types of logs.</span></span> <span data-ttu-id="e6176-269">たとえば、Web ログには Application Insights、会話には Cosmos DB、大きなペイロードには Azure Storage の使用を検討します。</span><span class="sxs-lookup"><span data-stu-id="e6176-269">For example, consider Application Insights for web logs, Cosmos DB for conversations, and Azure Storage for large payloads.</span></span> <span data-ttu-id="e6176-270">[Azure Storage への直接的な書き込み][transcript-storage]に関するページをご覧ください。</span><span class="sxs-lookup"><span data-stu-id="e6176-270">See [Write directly to Azure Storage][transcript-storage].</span></span>

<span data-ttu-id="e6176-271">**フィードバック**。</span><span class="sxs-lookup"><span data-stu-id="e6176-271">**Feedback**.</span></span> <span data-ttu-id="e6176-272">ユーザーがボットとのやり取りにどの程度満足しているかを理解しておくことも重要です。</span><span class="sxs-lookup"><span data-stu-id="e6176-272">It's also important to understand how satisfied users are with their bot interactions.</span></span> <span data-ttu-id="e6176-273">ユーザー フィードバックの記録がある場合は、このデータを使用して、特定のやり取りの改善や、AI モデルの再トレーニングに重点を置いてパフォーマンスを向上させることができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-273">If you have a record of user feedback, you can use this data to focus your efforts on improving certain interactions and retraining the AI models for improved performance.</span></span> <span data-ttu-id="e6176-274">フィードバックを使用して、システム内のモデル (LUIS など) を再トレーニングできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-274">Use the feedback to retrain the models, such as LUIS, in your system.</span></span>

<span data-ttu-id="e6176-275">**テスト**。</span><span class="sxs-lookup"><span data-stu-id="e6176-275">**Testing**.</span></span> <span data-ttu-id="e6176-276">ボットのテストには、単体テスト、統合テスト、回帰テスト、および機能テストが含まれます。</span><span class="sxs-lookup"><span data-stu-id="e6176-276">Testing a bot involves unit tests, integration tests, regression tests, and functional tests.</span></span> <span data-ttu-id="e6176-277">テストを行う場合、Azure Search や QnA Maker などの外部サービスからの実際の HTTP 応答を記録することをお勧めします。これにより、単体テストの際に、外部サービスへのネットワーク呼び出しを実際に行うことなく応答を再生することができます。</span><span class="sxs-lookup"><span data-stu-id="e6176-277">For testing, we recommend recording real HTTP responses from external services, such as Azure Search or QnA Maker, so they can be played back during unit testing without needing to make real network calls to external services.</span></span>

>[!NOTE]
> <span data-ttu-id="e6176-278">これらの領域での開発を首尾よく開始するには、「[Botbuilder Utils for JavaScript (JavaScript 用 Botbuilder ユーティリティ)][git-repo-base]」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="e6176-278">To jump-start your development in these areas, look at the [Botbuilder Utils for JavaScript][git-repo-base].</span></span> <span data-ttu-id="e6176-279">このリポジトリには、[Microsoft Bot Framework v4][bot-framework] でビルドされ、Node.js を実行するボット用のサンプル ユーティリティ コードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e6176-279">This repo contains sample utility code for bots built with [Microsoft Bot Framework v4][bot-framework] and running Node.js.</span></span> <span data-ttu-id="e6176-280">次のパッケージが含まれます。</span><span class="sxs-lookup"><span data-stu-id="e6176-280">It includes the following packages:</span></span>
>
> - <span data-ttu-id="e6176-281">[Cosmos DB のログ ストア][cosmosdb-logger]。</span><span class="sxs-lookup"><span data-stu-id="e6176-281">[Cosmos DB Logging Store][cosmosdb-logger].</span></span> <span data-ttu-id="e6176-282">Cosmos DB でボット ログを保管したり、クエリを実行したりする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e6176-282">Shows how to store and query bot logs in Cosmos DB.</span></span>
> - <span data-ttu-id="e6176-283">[Application Insights のログ ストア][appinsights-logger]。</span><span class="sxs-lookup"><span data-stu-id="e6176-283">[Application Insights Logging Store][appinsights-logger].</span></span> <span data-ttu-id="e6176-284">Application Insights でボット ログを保管したり、クエリを実行したりする方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e6176-284">Shows how to store and query bot logs in Application Insights.</span></span>
> - <span data-ttu-id="e6176-285">[フィードバック コレクション ミドルウェア][feedback-util]。</span><span class="sxs-lookup"><span data-stu-id="e6176-285">[Feedback Collection Middleware][feedback-util].</span></span> <span data-ttu-id="e6176-286">ボット ユーザーにフィードバック要求メカニズムを提供するサンプル ミドルウェアです。</span><span class="sxs-lookup"><span data-stu-id="e6176-286">Sample middleware that provides a bot user feedback-request mechanism.</span></span>
> - <span data-ttu-id="e6176-287">[HTTP テスト レコーダー][testing util]。</span><span class="sxs-lookup"><span data-stu-id="e6176-287">[Http Test Recorder][testing util].</span></span> <span data-ttu-id="e6176-288">ボットの外部サービスからの HTTP トラフィックを記録します。</span><span class="sxs-lookup"><span data-stu-id="e6176-288">Records HTTP traffic from services external to the bot.</span></span> <span data-ttu-id="e6176-289">LUIS、Azure Search、および QnA Maker のサポートが事前に組み込まれていますが、拡張機能を使用して任意のサービスをサポートすることもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-289">It comes pre-built with support for LUIS, Azure Search, and QnAMaker, but extensions are available to support any service.</span></span> <span data-ttu-id="e6176-290">これは、ボットのテストを自動化する際に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="e6176-290">This helps you automate bot testing.</span></span>
>
> <span data-ttu-id="e6176-291">これらのパッケージはユーティリティ サンプル コードとして提供されており、サポートや更新プログラムの保証は付属しません。</span><span class="sxs-lookup"><span data-stu-id="e6176-291">These packages are provided as utility sample code, and come with no guarantee of support or updates.</span></span>

## <a name="availability-considerations"></a><span data-ttu-id="e6176-292">可用性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e6176-292">Availability considerations</span></span>

<span data-ttu-id="e6176-293">ボットに新しい機能やバグ修正をロールアウトする際は、ステージングや運用など、複数のデプロイ環境を使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-293">As you roll out new features or bug fixes to your bot, it's best to use multiple deployment environments, such as staging and production.</span></span> <span data-ttu-id="e6176-294">[Azure DevOps][devops] のデプロイ [スロット][slots]を使用すると、ダウンタイムなしでこれを実行できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-294">Using deployment [slots][slots] from [Azure DevOps][devops] allows you to do this with zero downtime.</span></span> <span data-ttu-id="e6176-295">最新のアップグレードを運用環境にスワップする前に、ステージング環境でテストできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-295">You can test your latest upgrades in the staging environment before swapping them to the production environment.</span></span> <span data-ttu-id="e6176-296">負荷の処理に関しては、App Service は手動または自動でスケール アップしたりスケール アウトしたりできるように設計されています。</span><span class="sxs-lookup"><span data-stu-id="e6176-296">In terms of handling load, App Service is designed to scale up or out manually or automatically.</span></span> <span data-ttu-id="e6176-297">お使いのボットは Microsoft のグローバルなデータセンター インフラストラクチャでホストされるため、App Service の SLA によって高可用性が保証されます。</span><span class="sxs-lookup"><span data-stu-id="e6176-297">Because your bot is hosted in Microsoft's global datacenter infrastructure, the App Service SLA promises high availability.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="e6176-298">セキュリティに関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e6176-298">Security considerations</span></span>

<span data-ttu-id="e6176-299">他のアプリケーションと同様に、ボットは機密データを処理するように設計できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-299">As with any other application, the bot can be designed to handle sensitive data.</span></span> <span data-ttu-id="e6176-300">そのため、サインインしてボットを使用できるユーザーを制限できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-300">Therefore, restrict who can sign in and use the bot.</span></span> <span data-ttu-id="e6176-301">また、ユーザーの ID やロールに基づいて、アクセスできるデータも制限できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-301">Also limit which data can be accessed, based on the user's identity or role.</span></span> <span data-ttu-id="e6176-302">ID とアクセス制御には Azure AD を使用し、キーとシークレットの管理には Key Vault を使用してください。</span><span class="sxs-lookup"><span data-stu-id="e6176-302">Use Azure AD for identity and access control and Key Vault to manage keys and secrets.</span></span>

## <a name="manageability-considerations"></a><span data-ttu-id="e6176-303">管理容易性に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="e6176-303">Manageability considerations</span></span>

### <a name="monitoring-and-reporting"></a><span data-ttu-id="e6176-304">監視と報告</span><span class="sxs-lookup"><span data-stu-id="e6176-304">Monitoring and reporting</span></span>

<span data-ttu-id="e6176-305">ボットが運用環境で稼働している場合は、ボットの稼働を維持する DevOps チームが必要になります。</span><span class="sxs-lookup"><span data-stu-id="e6176-305">Once your bot is running in production, you will need a DevOps team to keep it that way.</span></span> <span data-ttu-id="e6176-306">システムを継続的に監視して、ボットが最高のパフォーマンスで動作していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="e6176-306">Continually monitor the system to ensure the bot operates at peak performance.</span></span> <span data-ttu-id="e6176-307">Application Insights または Cosmos DB に送信されたログを使用して、Application Insights 自体、Power BI、またはカスタムの Web アプリ ダッシュボードで監視ダッシュボードを作成できます。</span><span class="sxs-lookup"><span data-stu-id="e6176-307">Use the logs sent to Application Insights or Cosmos DB to create monitoring dashboards, either using Application Insights itself, Power BI, or a custom web app dashboard.</span></span> <span data-ttu-id="e6176-308">重大なエラーが発生したり、パフォーマンスが許容されるしきい値を下回ったりした場合は、DevOps チームにアラートを送信します。</span><span class="sxs-lookup"><span data-stu-id="e6176-308">Send alerts to the DevOps team if critical errors occur or performance falls below an acceptable threshold.</span></span>

### <a name="automated-resource-deployment"></a><span data-ttu-id="e6176-309">自動化されたリソースのデプロイ</span><span class="sxs-lookup"><span data-stu-id="e6176-309">Automated resource deployment</span></span>

<span data-ttu-id="e6176-310">ボット自体は、ボットに最新データを提供したり、その適切な動作を確保する大規模なシステムの一部にすぎません。</span><span class="sxs-lookup"><span data-stu-id="e6176-310">The bot itself is only part of a larger system that provides it with the latest data and ensures its proper operation.</span></span> <span data-ttu-id="e6176-311">これらの他の Azure リソース (&mdash;Data Factory などのデータ オーケストレーション サービス、Cosmos DB などのストレージ サービス、その他&mdash;) を、すべてデプロイする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e6176-311">All of these other Azure resources &mdash; data orchestration services such as Data Factory, storage services such as Cosmos DB, and so forth &mdash; must be deployed.</span></span> <span data-ttu-id="e6176-312">Azure Resource Manager では、Azure portal、PowerShell、Azure CLI を通じてアクセスできる、一貫性のある管理レイヤーを提供します。</span><span class="sxs-lookup"><span data-stu-id="e6176-312">Azure Resource Manager provides a consistent management layer that you can access through the Azure portal, PowerShell, or the Azure CLI.</span></span> <span data-ttu-id="e6176-313">速度と一貫性を実現するには、これらの方法のいずれかを使用してデプロイを自動化することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-313">For speed and consistency, it's best to automate your deployment using one of these approaches.</span></span>

### <a name="continuous-bot-deployment"></a><span data-ttu-id="e6176-314">ボットの継続的なデプロイ</span><span class="sxs-lookup"><span data-stu-id="e6176-314">Continuous bot deployment</span></span>

<span data-ttu-id="e6176-315">ボットのロジックは、IDE から直接デプロイすることも、Azure CLI などのコマンド ラインからデプロイすることもできます。</span><span class="sxs-lookup"><span data-stu-id="e6176-315">You can deploy the bot logic directly from your IDE or from a command line, such as the Azure CLI.</span></span> <span data-ttu-id="e6176-316">ただし、ボットが成熟してきた場合は、[継続的なデプロイの設定](/azure/bot-service/bot-service-build-continuous-deployment)に関する記事の説明に従い、Azure DevOps などの CI/CD ソリューションを活用して継続的なデプロイ プロセスを使用することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-316">As your bot matures, however, it's best to use a continual deployment process using a CI/CD solution such as Azure DevOps, as described in the article [Set up continuous deployment](/azure/bot-service/bot-service-build-continuous-deployment).</span></span> <span data-ttu-id="e6176-317">これは、運用環境に近い環境でボットの新機能と修正プログラムをテストする際の煩雑さを軽減する優れた方法です。</span><span class="sxs-lookup"><span data-stu-id="e6176-317">This is a good way to ease the friction in testing new features and fixes in your bot in a near-production environment.</span></span> <span data-ttu-id="e6176-318">また、複数のデプロイ環境 (通常は最低でもステージング環境と運用環境) を用意することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e6176-318">It's also a good idea to have multiple deployment environments, typically at least staging and production.</span></span> <span data-ttu-id="e6176-319">Azure DevOps は、このアプローチをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e6176-319">Azure DevOps supports this approach.</span></span>

<!-- links -->

[0]: ./_images/conversational-bot.png
[aad]: /azure/active-directory/
[アクティビティ]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[activities]: /azure/bot-service/rest-api/bot-framework-rest-connector-activities
[aml]: /azure/machine-learning/service/
[app-insights]: /azure/azure-monitor/app/app-insights-overview
[app-service]: /azure/app-service/
[blob]: /azure/storage/blobs/storage-blobs-introduction
[bot-authentication]: /azure/bot-service/bot-builder-authentication
[bot-framework]: https://dev.botframework.com/
[bot-framework-service]: /azure/bot-service/bot-builder-basics
[cognitive-services]: /azure/cognitive-services/welcome
[会話]: /azure/bot-service/bot-service-design-conversation-flow
[conversations]: /azure/bot-service/bot-service-design-conversation-flow
[cosmosdb]: /azure/cosmos-db/
[data-factory]: /azure/data-factory/
[data-factory-ref-arch]: ../data/enterprise-bi-adf.md
[devops]: https://azure.microsoft.com/solutions/devops/
[functions]: /azure/azure-functions/
[functions-triggers]: /azure/azure-functions/functions-triggers-bindings
[git-repo-appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[git-repo-base]: https://github.com/Microsoft/botbuilder-utils-js
[git-repo-cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[git-repo-feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[git-repo-testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[testing-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder
[key-vault]: /azure/key-vault/
[lda]: https://wikipedia.org/wiki/Latent_Dirichlet_allocation/
[logic-apps]: /azure/logic-apps/logic-apps-overview
[luis]: /azure/cognitive-services/luis/
[power-bi]: /power-bi/
[qna-maker]: /azure/cognitive-services/QnAMaker/
[search]: /azure/search/
[slots]: /azure/app-service/deploy-staging-slots/
[synonyms]: /azure/search/search-synonyms
[transcript-storage]: /azure/bot-service/bot-builder-howto-v4-storage
[ターン]: /azure/bot-service/bot-builder-basics#defining-a-turn
[turns]: /azure/bot-service/bot-builder-basics#defining-a-turn
[vscode]: https://azure.microsoft.com/products/visual-studio-code/
[webapp]: /azure/app-service/overview
[webchat]: /azure/bot-service/bot-service-channel-connect-webchat?view=azure-bot-service-4.0/

[cosmosdb-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-cosmosdb
[appinsights-logger]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-transcript-app-insights
[feedback-util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-feedback
[testing util]: https://github.com/Microsoft/botbuilder-utils-js/tree/master/packages/botbuilder-http-test-recorder

